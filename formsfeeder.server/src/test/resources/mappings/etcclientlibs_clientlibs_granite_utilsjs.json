{
  "id" : "a3994d11-d51e-462d-ba5b-671c86c02f6b",
  "name" : "etcclientlibs_clientlibs_granite_utilsjs",
  "request" : {
    "url" : "/etc.clientlibs/clientlibs/granite/utils.js",
    "method" : "GET"
  },
  "response" : {
    "status" : 200,
    "base64Body" : "LyoKICogQURPQkUgQ09ORklERU5USUFMCiAqCiAqIENvcHlyaWdodCAyMDEyIEFkb2JlIFN5c3RlbXMgSW5jb3Jwb3JhdGVkCiAqIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCiAqCiAqIE5PVElDRTogIEFsbCBpbmZvcm1hdGlvbiBjb250YWluZWQgaGVyZWluIGlzLCBhbmQgcmVtYWlucwogKiB0aGUgcHJvcGVydHkgb2YgQWRvYmUgU3lzdGVtcyBJbmNvcnBvcmF0ZWQgYW5kIGl0cyBzdXBwbGllcnMsCiAqIGlmIGFueS4gIFRoZSBpbnRlbGxlY3R1YWwgYW5kIHRlY2huaWNhbCBjb25jZXB0cyBjb250YWluZWQKICogaGVyZWluIGFyZSBwcm9wcmlldGFyeSB0byBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZCBhbmQgaXRzCiAqIHN1cHBsaWVycyBhbmQgbWF5IGJlIGNvdmVyZWQgYnkgVS5TLiBhbmQgRm9yZWlnbiBQYXRlbnRzLAogKiBwYXRlbnRzIGluIHByb2Nlc3MsIGFuZCBhcmUgcHJvdGVjdGVkIGJ5IHRyYWRlIHNlY3JldCBvciBjb3B5cmlnaHQgbGF3LgogKiBEaXNzZW1pbmF0aW9uIG9mIHRoaXMgaW5mb3JtYXRpb24gb3IgcmVwcm9kdWN0aW9uIG9mIHRoaXMgbWF0ZXJpYWwKICogaXMgc3RyaWN0bHkgZm9yYmlkZGVuIHVubGVzcyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24gaXMgb2J0YWluZWQKICogZnJvbSBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZC4KICoKICovCihmdW5jdGlvbihmYWN0b3J5KSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgaWYgKHR5cGVvZiBtb2R1bGUgPT09ICJvYmplY3QiICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7CiAgICB9IGVsc2UgewogICAgICAgIHZhciBnID0gd2luZG93LkdyYW5pdGUgPSB3aW5kb3cuR3Jhbml0ZSB8fCB7fTsKICAgICAgICBnLlNsaW5nID0gZmFjdG9yeSgpOwogICAgfQp9KGZ1bmN0aW9uKCkgewogICAgInVzZSBzdHJpY3QiOwoKICAgIC8qKgogICAgICogQSBoZWxwZXIgY2xhc3MgcHJvdmlkaW5nIGEgc2V0IG9mIFNsaW5nLXJlbGF0ZWQgdXRpbGl0aWVzLgogICAgICogQHN0YXRpYwogICAgICogQHNpbmdsZXRvbgogICAgICogQGNsYXNzIEdyYW5pdGUuU2xpbmcKICAgICAqIEBkZXByZWNhdGVkIFVzaW5nIHRoZSBjb25zdGFudHMgaXMgbm8gbG9uZ2VyIG5lZWRlZCBhbmQgYWN0dWFsbHkgaXMgbm90IGEgYmVzdCBwcmFjdGljZSBhcyBpdCBpcyBub3QgUkVTVGZ1bCwKICAgICAqICAgICAgICAgICAgIHdoZXJlIHRoZSBzZXJ2ZXIgc2hvdWxkIGRyaXZlIHRoZSBjbGllbnQgdmlhIGh5cGVybWVkaWEgYW5kIHRoZSBjbGllbnQgc2hvdWxkIG5vdCBtYWtlIGFueQogICAgICogICAgICAgICAgICAgYXNzdW1wdGlvbiBhYm91dCB0aGUgVVJMLgogICAgICovCiAgICByZXR1cm4gewogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBzZWxlY3RvciBmb3IgaW5maW5pdGUgaGllcmFyY2h5IGRlcHRoIHdoZW4gcmV0cmlldmluZyByZXBvc2l0b3J5IGNvbnRlbnQuCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBmaW5hbAogICAgICAgICAqIEB0eXBlIFN0cmluZwogICAgICAgICAqLwogICAgICAgIFNFTEVDVE9SX0lORklOSVRZOiAiLmluZmluaXR5IiwKCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIHBhcmFtZXRlciBuYW1lIGZvciB0aGUgdXNlZCBjaGFyYWN0ZXIgc2V0LgogICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgKiBAZmluYWwKICAgICAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAgICAgKi8KICAgICAgICBDSEFSU0VUOiAiX2NoYXJzZXRfIiwKCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIHBhcmFtZXRlciBuYW1lIGZvciB0aGUgc3RhdHVzLgogICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgKiBAZmluYWwKICAgICAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAgICAgKi8KICAgICAgICBTVEFUVVM6ICI6c3RhdHVzIiwKCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIHBhcmFtZXRlciB2YWx1ZSBmb3IgdGhlIHN0YXR1cyB0eXBlICJicm93c2VyIi4KICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICogQGZpbmFsCiAgICAgICAgICogQHR5cGUgU3RyaW5nCiAgICAgICAgICovCiAgICAgICAgU1RBVFVTX0JST1dTRVI6ICJicm93c2VyIiwKCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIHBhcmFtZXRlciBuYW1lIGZvciB0aGUgb3BlcmF0aW9uLgogICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgKiBAZmluYWwKICAgICAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAgICAgKi8KICAgICAgICBPUEVSQVRJT046ICI6b3BlcmF0aW9uIiwKCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIHBhcmFtZXRlciB2YWx1ZSBmb3IgdGhlIGRlbGV0ZSBvcGVyYXRpb24uCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBmaW5hbAogICAgICAgICAqIEB0eXBlIFN0cmluZwogICAgICAgICAqLwogICAgICAgIE9QRVJBVElPTl9ERUxFVEU6ICJkZWxldGUiLAoKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgcGFyYW1ldGVyIHZhbHVlIGZvciB0aGUgbW92ZSBvcGVyYXRpb24uCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBmaW5hbAogICAgICAgICAqIEB0eXBlIFN0cmluZwogICAgICAgICAqLwogICAgICAgIE9QRVJBVElPTl9NT1ZFOiAibW92ZSIsCgogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBwYXJhbWV0ZXIgbmFtZSBzdWZmaXggZm9yIGRlbGV0aW5nLgogICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgKiBAZmluYWwKICAgICAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAgICAgKi8KICAgICAgICBERUxFVEVfU1VGRklYOiAiQERlbGV0ZSIsCgogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBwYXJhbWV0ZXIgbmFtZSBzdWZmaXggZm9yIHNldHRpbmcgYSB0eXBlIGhpbnQuCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBmaW5hbAogICAgICAgICAqIEB0eXBlIFN0cmluZwogICAgICAgICAqLwogICAgICAgIFRZUEVISU5UX1NVRkZJWDogIkBUeXBlSGludCIsCgogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBwYXJhbWV0ZXIgbmFtZSBzdWZmaXggZm9yIGNvcHlpbmcuCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBmaW5hbAogICAgICAgICAqIEB0eXBlIFN0cmluZwogICAgICAgICAqLwogICAgICAgIENPUFlfU1VGRklYOiAiQENvcHlGcm9tIiwKCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIHBhcmFtZXRlciBuYW1lIHN1ZmZpeCBmb3IgbW92aW5nLgogICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgKiBAZmluYWwKICAgICAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAgICAgKi8KICAgICAgICBNT1ZFX1NVRkZJWDogIkBNb3ZlRnJvbSIsCgogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBwYXJhbWV0ZXIgbmFtZSBmb3IgdGhlIG9yZGVyaW5nLgogICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgKiBAZmluYWwKICAgICAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAgICAgKi8KICAgICAgICBPUkRFUjogIjpvcmRlciIsCgogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBwYXJhbWV0ZXIgbmFtZSBmb3IgdGhlIHJlcGxhY2UgZmxhZy4KICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICogQGZpbmFsCiAgICAgICAgICogQHR5cGUgU3RyaW5nCiAgICAgICAgICovCiAgICAgICAgUkVQTEFDRTogIjpyZXBsYWNlIiwKCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIHBhcmFtZXRlciBuYW1lIGZvciB0aGUgZGVzdGluYXRpb24gZmxhZy4KICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICogQGZpbmFsCiAgICAgICAgICogQHR5cGUgU3RyaW5nCiAgICAgICAgICovCiAgICAgICAgREVTVElOQVRJT046ICI6ZGVzdCIsCgogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBwYXJhbWV0ZXIgbmFtZSBmb3IgdGhlIHNhdmUgcGFyYW1ldGVyIHByZWZpeC4KICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICogQGZpbmFsCiAgICAgICAgICogQHR5cGUgU3RyaW5nCiAgICAgICAgICovCiAgICAgICAgU0FWRV9QQVJBTV9QUkVGSVg6ICI6c2F2ZVBhcmFtUHJlZml4IiwKCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIHBhcmFtZXRlciBuYW1lIGZvciBpbnB1dCBmaWVsZHMgdGhhdCBzaG91bGQgYmUgaWdub3JlZCBieSBTbGluZy4KICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICogQGZpbmFsCiAgICAgICAgICogQHR5cGUgU3RyaW5nCiAgICAgICAgICovCiAgICAgICAgSUdOT1JFX1BBUkFNOiAiOmlnbm9yZSIsCgogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBwYXJhbWV0ZXIgbmFtZSBmb3IgbG9naW4gcmVxdWVzdHMuCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBmaW5hbAogICAgICAgICAqIEB0eXBlIFN0cmluZwogICAgICAgICAqLwogICAgICAgIFJFUVVFU1RfTE9HSU5fUEFSQU06ICJzbGluZzphdXRoUmVxdWVzdExvZ2luIiwKCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGxvZ2luIFVSTC4KICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICogQGZpbmFsCiAgICAgICAgICogQHR5cGUgU3RyaW5nCiAgICAgICAgICovCiAgICAgICAgTE9HSU5fVVJMOiAiL3N5c3RlbS9zbGluZy9sb2dpbi5odG1sIiwKCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGxvZ291dCBVUkwuCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBmaW5hbAogICAgICAgICAqIEB0eXBlIFN0cmluZwogICAgICAgICAqLwogICAgICAgIExPR09VVF9VUkw6ICIvc3lzdGVtL3NsaW5nL2xvZ291dC5odG1sIgogICAgfTsKfSkpOwoKLyoKICogQURPQkUgQ09ORklERU5USUFMCiAqCiAqIENvcHlyaWdodCAyMDEyIEFkb2JlIFN5c3RlbXMgSW5jb3Jwb3JhdGVkCiAqIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCiAqCiAqIE5PVElDRTogIEFsbCBpbmZvcm1hdGlvbiBjb250YWluZWQgaGVyZWluIGlzLCBhbmQgcmVtYWlucwogKiB0aGUgcHJvcGVydHkgb2YgQWRvYmUgU3lzdGVtcyBJbmNvcnBvcmF0ZWQgYW5kIGl0cyBzdXBwbGllcnMsCiAqIGlmIGFueS4gIFRoZSBpbnRlbGxlY3R1YWwgYW5kIHRlY2huaWNhbCBjb25jZXB0cyBjb250YWluZWQKICogaGVyZWluIGFyZSBwcm9wcmlldGFyeSB0byBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZCBhbmQgaXRzCiAqIHN1cHBsaWVycyBhbmQgbWF5IGJlIGNvdmVyZWQgYnkgVS5TLiBhbmQgRm9yZWlnbiBQYXRlbnRzLAogKiBwYXRlbnRzIGluIHByb2Nlc3MsIGFuZCBhcmUgcHJvdGVjdGVkIGJ5IHRyYWRlIHNlY3JldCBvciBjb3B5cmlnaHQgbGF3LgogKiBEaXNzZW1pbmF0aW9uIG9mIHRoaXMgaW5mb3JtYXRpb24gb3IgcmVwcm9kdWN0aW9uIG9mIHRoaXMgbWF0ZXJpYWwKICogaXMgc3RyaWN0bHkgZm9yYmlkZGVuIHVubGVzcyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24gaXMgb2J0YWluZWQKICogZnJvbSBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZC4KICoKICovCihmdW5jdGlvbihmYWN0b3J5KSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgaWYgKHR5cGVvZiBtb2R1bGUgPT09ICJvYmplY3QiICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7CiAgICB9IGVsc2UgewogICAgICAgIHZhciBnID0gd2luZG93LkdyYW5pdGUgPSB3aW5kb3cuR3Jhbml0ZSB8fCB7fTsKICAgICAgICBnLlV0aWwgPSBmYWN0b3J5KCk7CiAgICB9Cn0oZnVuY3Rpb24oKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvQXJyYXkvaXNBcnJheSNQb2x5ZmlsbAogICAgdmFyIGlzQXJyYXkgPSBmdW5jdGlvbihhcmcpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGFyZykgPT09ICJbb2JqZWN0IEFycmF5XSI7CiAgICB9OwoKICAgIC8qKgogICAgICogQSBoZWxwZXIgY2xhc3MgcHJvdmlkaW5nIGEgc2V0IG9mIGdlbmVyYWwgdXRpbGl0aWVzLgogICAgICogQHN0YXRpYwogICAgICogQHNpbmdsZXRvbgogICAgICogQGNsYXNzIEdyYW5pdGUuVXRpbAogICAgICovCiAgICByZXR1cm4gewogICAgICAgIC8qKgogICAgICAgICAqIFJlcGxhY2VzIG9jY3VycmVuY2VzIG9mIDxjb2RlPntufTwvY29kZT4gaW4gdGhlIHNwZWNpZmllZCB0ZXh0IHdpdGggdGhlIHRleHRzIGZyb20gdGhlIHNuaXBwZXRzLgogICAgICAgICAqCiAgICAgICAgICogQGV4YW1wbGUKICAgICAgICAgKiB2YXIgdGV4dCA9IEdyYW5pdGUuVXRpbC5wYXRjaFRleHQoInswfSBoYXMgc2lnbmVkIGluLiIsICJKYWNrIik7CiAgICAgICAgICogLy8gdGV4dCA9ICJKYWNrIGhhcyBzaWduZWQgaW4uIgogICAgICAgICAqIHZhciB0ZXh0MiA9IEdyYW5pdGUuVXRpbC5wYXRjaFRleHQoInswfSB7MX0gaGFzIHNpZ25lZCBpbiBmcm9tIHsyfS4iLCBbIkphY2siLCAiTWNGYXJsYW5kIiwgIngueC54LngiXSk7CiAgICAgICAgICogLy8gdGV4dDIgPSAiSmFjayBNY0ZhcmxhbmQgaGFzIHNpZ25lZCBpbiBmcm9tIHgueC54LnguIgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHRleHQgVGhlIHRleHQuCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd8U3RyaW5nW119IHNuaXBwZXRzIFRoZSB0ZXh0KHMpIHJlcGxhY2luZyA8Y29kZT57bn08L2NvZGU+LgogICAgICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IFRoZSBwYXRjaGVkIHRleHQuCiAgICAgICAgICovCiAgICAgICAgcGF0Y2hUZXh0OiBmdW5jdGlvbih0ZXh0LCBzbmlwcGV0cykgewogICAgICAgICAgICBpZiAoc25pcHBldHMpIHsKICAgICAgICAgICAgICAgIGlmICghaXNBcnJheShzbmlwcGV0cykpIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKCJ7MH0iLCBzbmlwcGV0cyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc25pcHBldHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgoInsiICsgaSArICJ9IiksIHNuaXBwZXRzW2ldKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRleHQ7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgdG9wIG1vc3QgYWNjZXNzaWJsZSB3aW5kb3cuCiAgICAgICAgICogQ2hlY2sge0BsaW5rIC5zZXRJRnJhbWVNb2RlfSB0byBhdm9pZCBzZWN1cml0eSBleGNlcHRpb24gbWVzc2FnZSBvbiBXZWJLaXQgYnJvd3NlcnMKICAgICAgICAgKiBpZiB0aGlzIG1ldGhvZCBpcyBjYWxsZWQgaW4gYW4gaUZyYW1lIGluY2x1ZGVkIGluIGEgd2luZG93IGZyb20gZGlmZmVyZW50IGRvbWFpbi4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm5zIHtXaW5kb3d9IFRoZSB0b3Agd2luZG93LgogICAgICAgICAqLwogICAgICAgIGdldFRvcFdpbmRvdzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciB3aW4gPSB3aW5kb3c7CiAgICAgICAgICAgIGlmICh0aGlzLmlGcmFtZVRvcFdpbmRvdykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaUZyYW1lVG9wV2luZG93OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyB0cnkgdG8gYWNjZXNzIHBhcmVudAogICAgICAgICAgICAgICAgLy8gd2luLnBhcmVudC5sb2NhdGlvbi5ocmVmIHRocm93cyBhbiBleGNlcHRpb24gaWYgbm90IGF1dGhvcml6ZWQgKGUuZy4gZGlmZmVyZW50IGxvY2F0aW9uIGluIGEgcG9ydGxldCkKICAgICAgICAgICAgICAgIHdoaWxlICh3aW4ucGFyZW50ICYmIHdpbiAhPT0gd2luLnBhcmVudCAmJiB3aW4ucGFyZW50LmxvY2F0aW9uLmhyZWYpIHsKICAgICAgICAgICAgICAgICAgICB3aW4gPSB3aW4ucGFyZW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgLy8gaWdub3JlZAogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB3aW47CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQWxsb3dzIHRvIGRlZmluZSBpZiBHcmFuaXRlLlV0aWwgaXMgcnVubmluZyBpbiBhbiBpRnJhbWUgYW5kIHBhcmVudCB3aW5kb3cgaXMgaW4gYW5vdGhlciBkb21haW4KICAgICAgICAgKiAoYW5kIG9wdGlvbmFsbHkgZGVmaW5lIHdoYXQgd291bGQgYmUgdGhlIHRvcCB3aW5kb3cgaW4gdGhhdCBjYXNlLgogICAgICAgICAqIFRoaXMgaXMgbmVjZXNzYXJ5IHRvIHVzZSB7QGxpbmsgLmdldFRvcFdpbmRvd30gaW4gYSBpRnJhbWUgb24gV2ViS2l0IGJhc2VkIGJyb3dzZXJzIGJlY2F1c2UKICAgICAgICAgKiB7QGxpbmsgLmdldFRvcFdpbmRvd30gaXRlcmF0ZXMgb24gcGFyZW50IHdpbmRvd3MgdG8gZmluZCB0aGUgdG9wIG9uZSB3aGljaCB0cmlnZ2VycyBhIHNlY3VyaXR5IGV4Y2VwdGlvbgogICAgICAgICAqIGlmIG9uZSBwYXJlbnQgd2luZG93IGlzIGluIGEgZGlmZmVyZW50IGRvbWFpbi4gRXhjZXB0aW9uIGNhbm5vdCBiZSBjYXVnaHQgYnV0IGlzIG5vdCBicmVha2luZyB0aGUgSlMKICAgICAgICAgKiBleGVjdXRpb24uCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge1dpbmRvd30gW3RvcFdpbmRvdz13aW5kb3ddIFRoZSBpRnJhbWUgdG9wIHdpbmRvdy4gTXVzdCBiZSBydW5uaW5nIG9uIHRoZSBzYW1lIGhvc3QgdG8gYXZvaWQKICAgICAgICAgKiBzZWN1cml0eSBleGNlcHRpb24uCiAgICAgICAgICovCiAgICAgICAgc2V0SUZyYW1lTW9kZTogZnVuY3Rpb24odG9wV2luZG93KSB7CiAgICAgICAgICAgIHRoaXMuaUZyYW1lVG9wV2luZG93ID0gdG9wV2luZG93IHx8IHdpbmRvdzsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBBcHBsaWVzIGRlZmF1bHQgcHJvcGVydGllcyBpZiBub24tZXhpc3RlbnQgaW50byB0aGUgYmFzZSBvYmplY3QuCiAgICAgICAgICogQ2hpbGQgb2JqZWN0cyBhcmUgbWVyZ2VkIHJlY3Vyc2l2ZWx5LgogICAgICAgICAqIFJFTUFSSzoKICAgICAgICAgKiAgIC0gb2JqZWN0cyBhcmUgcmVjdXJzaXZlbHkgbWVyZ2VkCiAgICAgICAgICogICAtIHNpbXBsZSB0eXBlIG9iamVjdCBwcm9wZXJ0aWVzIGFyZSBjb3BpZWQgb3ZlciB0aGUgYmFzZQogICAgICAgICAqICAgLSBhcnJheXMgYXJlIGNsb25lZCBhbmQgb3ZlcnJpZGUgdGhlIGJhc2UgKG5vIHZhbHVlIG1lcmdpbmcpCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gYmFzZSBUaGUgb2JqZWN0LgogICAgICAgICAqIEBwYXJhbSB7Li4uT2JqZWN0fSBwYXNzIFRoZSBvYmplY3RzIHRvIGJlIGNvcGllZCBvbnRvIHRoZSBiYXNlLgogICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBiYXNlIG9iamVjdCB3aXRoIGRlZmF1bHRzLgogICAgICAgICAqLwogICAgICAgIGFwcGx5RGVmYXVsdHM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgb3ZlcnJpZGU7CiAgICAgICAgICAgIHZhciBiYXNlID0gYXJndW1lbnRzWzBdIHx8IHt9OwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIG92ZXJyaWRlID0gYXJndW1lbnRzW2ldOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIG5hbWUgaW4gb3ZlcnJpZGUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBvdmVycmlkZVtuYW1lXTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKG92ZXJyaWRlLmhhc093blByb3BlcnR5KG5hbWUpICYmIHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSBudWxsICYmIHR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYgISh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbmVzdGVkIG9iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZVtuYW1lXSA9IHRoaXMuYXBwbHlEZWZhdWx0cyhiYXNlW25hbWVdLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb3ZlcnJpZGUgYXJyYXkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VbbmFtZV0gPSB2YWx1ZS5zbGljZSgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNpbXBsZSB0eXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlW25hbWVdID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBiYXNlOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIGtleWNvZGUgZnJvbSB0aGUgZ2l2ZW4gZXZlbnQuCiAgICAgICAgICogSXQgaXMgYSBub3JtYWxpemVkIHZhbHVlIG92ZXIgdmFyaWF0aW9uIG9mIGJyb3dzZXJzJyBpbmNvbnNpc3RlbmNpZXMuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge1VJRXZlbnR9IGV2ZW50IFRoZSBldmVudC4KICAgICAgICAgKiBAcmV0dXJucyB7TnVtYmVyfSBUaGUga2V5Y29kZS4KICAgICAgICAgKi8KICAgICAgICBnZXRLZXlDb2RlOiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICByZXR1cm4gZXZlbnQua2V5Q29kZSA/IGV2ZW50LmtleUNvZGUgOiBldmVudC53aGljaDsKICAgICAgICB9CiAgICB9Owp9KSk7CgovKgogKiBBRE9CRSBDT05GSURFTlRJQUwKICoKICogQ29weXJpZ2h0IDIwMTIgQWRvYmUgU3lzdGVtcyBJbmNvcnBvcmF0ZWQKICogQWxsIFJpZ2h0cyBSZXNlcnZlZC4KICoKICogTk9USUNFOiAgQWxsIGluZm9ybWF0aW9uIGNvbnRhaW5lZCBoZXJlaW4gaXMsIGFuZCByZW1haW5zCiAqIHRoZSBwcm9wZXJ0eSBvZiBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZCBhbmQgaXRzIHN1cHBsaWVycywKICogaWYgYW55LiAgVGhlIGludGVsbGVjdHVhbCBhbmQgdGVjaG5pY2FsIGNvbmNlcHRzIGNvbnRhaW5lZAogKiBoZXJlaW4gYXJlIHByb3ByaWV0YXJ5IHRvIEFkb2JlIFN5c3RlbXMgSW5jb3Jwb3JhdGVkIGFuZCBpdHMKICogc3VwcGxpZXJzIGFuZCBtYXkgYmUgY292ZXJlZCBieSBVLlMuIGFuZCBGb3JlaWduIFBhdGVudHMsCiAqIHBhdGVudHMgaW4gcHJvY2VzcywgYW5kIGFyZSBwcm90ZWN0ZWQgYnkgdHJhZGUgc2VjcmV0IG9yIGNvcHlyaWdodCBsYXcuCiAqIERpc3NlbWluYXRpb24gb2YgdGhpcyBpbmZvcm1hdGlvbiBvciByZXByb2R1Y3Rpb24gb2YgdGhpcyBtYXRlcmlhbAogKiBpcyBzdHJpY3RseSBmb3JiaWRkZW4gdW5sZXNzIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbiBpcyBvYnRhaW5lZAogKiBmcm9tIEFkb2JlIFN5c3RlbXMgSW5jb3Jwb3JhdGVkLgogKgogKi8KLyogZ2xvYmFsIENRVVJMSW5mbzpmYWxzZSwgR19YSFJfSE9PSzpmYWxzZSAqLwovKiBlc2xpbnQgc3RyaWN0OiAwICovCihmdW5jdGlvbihmYWN0b3J5KSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgaWYgKHR5cGVvZiBtb2R1bGUgPT09ICJvYmplY3QiICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoIkBncmFuaXRlL3V0aWwiKSwgcmVxdWlyZSgianF1ZXJ5IikpOwogICAgfSBlbHNlIHsKICAgICAgICB3aW5kb3cuR3Jhbml0ZS5IVFRQID0gZmFjdG9yeShHcmFuaXRlLlV0aWwsIGpRdWVyeSk7CiAgICB9Cn0oZnVuY3Rpb24odXRpbCwgJCkgewogICAgLyoqCiAgICAgKiBBIGhlbHBlciBjbGFzcyBwcm92aWRpbmcgYSBzZXQgb2YgSFRUUC1yZWxhdGVkIHV0aWxpdGllcy4KICAgICAqIEBzdGF0aWMKICAgICAqIEBzaW5nbGV0b24KICAgICAqIEBjbGFzcyBHcmFuaXRlLkhUVFAKICAgICAqLwogICAgcmV0dXJuIChmdW5jdGlvbigpIHsKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgY29udGV4dCBwYXRoIHVzZWQgb24gdGhlIHNlcnZlci4KICAgICAgICAgKiBNYXkgb25seSBiZSBzZXQgYnkge0BsaW5rICNkZXRlY3RDb250ZXh0UGF0aH0uCiAgICAgICAgICogQHR5cGUgU3RyaW5nCiAgICAgICAgICovCiAgICAgICAgdmFyIGNvbnRleHRQYXRoID0gbnVsbDsKCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byBkZXRlY3QgdGhlIGNvbnRleHQgcGF0aCB1c2VkCiAgICAgICAgICogb24gdGhlIHNlcnZlciB1c2luZyB0aGUgVVJMIG9mIHRoaXMgc2NyaXB0LgogICAgICAgICAqIEByZWFkb25seQogICAgICAgICAqIEB0eXBlIFJlZ0V4cAogICAgICAgICAqLwogICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtbGVuCiAgICAgICAgdmFyIFNDUklQVF9VUkxfUkVHRVhQID0gL14oPzpodHRwfGh0dHBzKTpcL1wvW14vXSsoXC8uKilcLyg/OmV0Y1wuY2xpZW50bGlic3xldGMoXC8uKikqXC9jbGllbnRsaWJzfGxpYnMoXC8uKikqXC9jbGllbnRsaWJzfGFwcHMoXC8uKikqXC9jbGllbnRsaWJzfGV0Y1wvZGVzaWducykuKlwuanMoXD8uKik/JC87CgogICAgICAgIC8qKgogICAgICAgICAqIFRoZSByZWd1bGFyIGV4cHJlc3Npb24gdG8gbWF0Y2ggYCNgIGFuZCBvdGhlciBub24tQVNDSUkgY2hhcmFjdGVycyBpbiBhIFVSSS4KICAgICAgICAgKiBAcmVhZG9ubHkKICAgICAgICAgKiBAdHlwZSBSZWdFeHAKICAgICAgICAgKi8KICAgICAgICB2YXIgRU5DT0RFX1BBVEhfUkVHRVhQID0gL1teXHctLn4lOi8/W1xdQCEkJicoKSorLDs9XS87CgogICAgICAgIC8qKgogICAgICAgICAqIFRoZSByZWd1bGFyIGV4cHJlc3Npb24gdG8gcGFyc2UgVVJJLgogICAgICAgICAqIEByZWFkb25seQogICAgICAgICAqIEB0eXBlIFJlZ0V4cAogICAgICAgICAqIEBzZWUgaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzM5ODYjYXBwZW5kaXgtQgogICAgICAgICAqLwogICAgICAgIHZhciBVUklfUkVHRVhQID0gL14oKFteOi8/I10rKTopPyhcL1wvKFteLz8jXSopKT8oW14/I10qKShcPyhbXiNdKikpPygjKC4qKSk/LzsKCiAgICAgICAgLyoqCiAgICAgICAgICogSW5kaWNhdGVzIGFmdGVyIGEgc2Vzc2lvbiB0aW1lb3V0IGlmIGEgcmVmcmVzaCBoYXMgYWxyZWFkeSBiZWVuIHRyaWdnZXJlZAogICAgICAgICAqIGluIG9yZGVyIHRvIGF2b2lkIG11bHRpcGxlIGFsZXJ0cy4KICAgICAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAgICAgKi8KICAgICAgICB2YXIgbG9naW5SZWRpcmVjdGVkID0gZmFsc2U7CgogICAgICAgIHZhciBzZWxmID0ge307CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIHNjaGVtZSBhbmQgYXV0aG9yaXR5ICh1c2VyaW5mbywgaG9zdCwgcG9ydCkgY29tcG9uZW50cyBvZiB0aGUgZ2l2ZW4gVVJJOwogICAgICAgICAqIG9yIGFuIGVtcHR5IHN0cmluZyBpZiB0aGUgVVJJIGRvZXMgbm90IGhhdmUgdGhlIGNvbXBvbmVudHMuCiAgICAgICAgICoKICAgICAgICAgKiBUaGlzIG1ldGhvZCBhc3N1bWVzIHRoZSBVUkkgaXMgdmFsaWQuCiAgICAgICAgICoKICAgICAgICAgKiBlLmcuIGBzY2hlbWU6Ly91c2VyaW5mb0Bob3N0OjgwL3BhdGg/cXVlcnkjZnJhZ21lbnRgIC0+IGBzY2hlbWU6Ly91c2VyaW5mb0Bob3N0OjgwYAogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHVyaSBUaGUgVVJJCiAgICAgICAgICogQHJldHVybnMge1N0cmluZ30gVGhlIHNjaGVtZSBhbmQgYXV0aG9yaXR5IGNvbXBvbmVudHMKICAgICAgICAgKi8KICAgICAgICBzZWxmLmdldFNjaGVtZUFuZEF1dGhvcml0eSA9IGZ1bmN0aW9uKHVyaSkgewogICAgICAgICAgICBpZiAoIXVyaSkgewogICAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVzdWx0ID0gVVJJX1JFR0VYUC5leGVjKHVyaSk7CgogICAgICAgICAgICBpZiAocmVzdWx0ID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBbIHJlc3VsdFsxXSwgcmVzdWx0WzNdIF0uam9pbigiIik7CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgY29udGV4dCBwYXRoIHVzZWQgb24gdGhlIHNlcnZlci4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IFRoZSBjb250ZXh0IHBhdGgKICAgICAgICAgKi8KICAgICAgICBzZWxmLmdldENvbnRleHRQYXRoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIC8vIEtlZXAgY2FjaGUgb2YgY2FsY3VsYXRlZCBwYXRoLgogICAgICAgICAgICBpZiAoY29udGV4dFBhdGggPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGNvbnRleHRQYXRoID0gc2VsZi5kZXRlY3RDb250ZXh0UGF0aCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb250ZXh0UGF0aDsKICAgICAgICB9OwoKICAgICAgICAvKioKICAgICAgICAgKiBEZXRlY3RzIHRoZSBjb250ZXh0IHBhdGggdXNlZCBvbiB0aGUgc2VydmVyLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybnMge1N0cmluZ30gVGhlIGNvbnRleHQgcGF0aAogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgc2VsZi5kZXRlY3RDb250ZXh0UGF0aCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5DUVVSTEluZm8pIHsKICAgICAgICAgICAgICAgICAgICBjb250ZXh0UGF0aCA9IENRVVJMSW5mby5jb250ZXh0UGF0aCB8fCAiIjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0Iik7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzY3JpcHRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBTQ1JJUFRfVVJMX1JFR0VYUC5leGVjKHNjcmlwdHNbaV0uc3JjKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dFBhdGggPSByZXN1bHRbMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29udGV4dFBhdGg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29udGV4dFBhdGggPSAiIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgLy8gaWdub3JlZAogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gY29udGV4dFBhdGg7CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogTWFrZXMgc3VyZSB0aGUgc3BlY2lmaWVkIHJlbGF0aXZlIFVSTCBzdGFydHMgd2l0aCB0aGUgY29udGV4dCBwYXRoCiAgICAgICAgICogdXNlZCBvbiB0aGUgc2VydmVyLiBJZiBhbiBhYnNvbHV0ZSBVUkwgaXMgcGFzc2VkLCBpdCB3aWxsIGJlIHJldHVybmVkCiAgICAgICAgICogYXMtaXMuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdXJsIFRoZSBVUkwKICAgICAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgZXh0ZXJuYWxpemVkIFVSTAogICAgICAgICAqLwogICAgICAgIHNlbGYuZXh0ZXJuYWxpemUgPSBmdW5jdGlvbih1cmwpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICh1cmwuaW5kZXhPZigiLyIpID09PSAwICYmIHNlbGYuZ2V0Q29udGV4dFBhdGgoKSAmJiB1cmwuaW5kZXhPZihzZWxmLmdldENvbnRleHRQYXRoKCkgKyAiLyIpICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdXJsID0gc2VsZi5nZXRDb250ZXh0UGF0aCgpICsgdXJsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAvLyBpZ25vcmVkCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHVybDsKICAgICAgICB9OwoKICAgICAgICAvKioKICAgICAgICAgKiBSZW1vdmVzIHNjaGVtZSwgYXV0aG9yaXR5IGFuZCBjb250ZXh0IHBhdGggZnJvbSB0aGUgc3BlY2lmaWVkCiAgICAgICAgICogYWJzb2x1dGUgVVJMIGlmIGl0IGhhcyB0aGUgc2FtZSBzY2hlbWUgYW5kIGF1dGhvcml0eSBhcyB0aGUKICAgICAgICAgKiBzcGVjaWZpZWQgZG9jdW1lbnQgKG9yIHRoZSBjdXJyZW50IG9uZSkuIElmIGEgcmVsYXRpdmUgVVJMIGlzIHBhc3NlZCwKICAgICAgICAgKiB0aGUgY29udGV4dCBwYXRoIHdpbGwgYmUgc3RyaXBwZWQgaWYgcHJlc2VudC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmwgVGhlIFVSTAogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkb2MgKG9wdGlvbmFsKSBUaGUgZG9jdW1lbnQKICAgICAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgaW50ZXJuYWxpemVkIFVSTAogICAgICAgICAqLwogICAgICAgIHNlbGYuaW50ZXJuYWxpemUgPSBmdW5jdGlvbih1cmwsIGRvYykgewogICAgICAgICAgICBpZiAodXJsLmNoYXJBdCgwKSA9PT0gIi8iKSB7CiAgICAgICAgICAgICAgICBpZiAoY29udGV4dFBhdGggPT09IHVybCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGV4dFBhdGggJiYgdXJsLmluZGV4T2YoY29udGV4dFBhdGggKyAiLyIpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVybC5zdWJzdHJpbmcoY29udGV4dFBhdGgubGVuZ3RoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVybDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFkb2MpIHsKICAgICAgICAgICAgICAgIGRvYyA9IGRvY3VtZW50OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBkb2NIb3N0ID0gc2VsZi5nZXRTY2hlbWVBbmRBdXRob3JpdHkoZG9jLmxvY2F0aW9uLmhyZWYpOwogICAgICAgICAgICB2YXIgdXJsSG9zdCA9IHNlbGYuZ2V0U2NoZW1lQW5kQXV0aG9yaXR5KHVybCk7CiAgICAgICAgICAgIGlmIChkb2NIb3N0ID09PSB1cmxIb3N0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdXJsLnN1YnN0cmluZyh1cmxIb3N0Lmxlbmd0aCArIChjb250ZXh0UGF0aCA/IGNvbnRleHRQYXRoLmxlbmd0aCA6IDApKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiB1cmw7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICAvKioKICAgICAgICAgKiBSZW1vdmVzIGFsbCBwYXJ0cyBidXQgdGhlIHBhdGggZnJvbSB0aGUgc3BlY2lmaWVkIFVSTC4KICAgICAgICAgKiA8cD5FeGFtcGxlczo8cHJlPjxjb2RlPgogICAgICAgICAveC95LnNlbC5odG1sP3BhcmFtPWFiYyA9PiAveC95CiAgICAgICAgIDwvY29kZT48L3ByZT4KICAgICAgICAgKiA8cHJlPjxjb2RlPgogICAgICAgICBodHRwOi8vd3d3LmRheS5jb20vZm9vL2Jhci5odG1sID0+IC9mb28vYmFyCiAgICAgICAgIDwvY29kZT48L3ByZT48cD4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmwgVGhlIFVSTCwgbWF5IGJlIGVtcHR5LiBJZiBlbXB0eSA8Y29kZT53aW5kb3cubG9jYXRpb24uaHJlZjwvY29kZT4gaXMgdGFrZW4uCiAgICAgICAgICogQHJldHVybnMge1N0cmluZ30gVGhlIHBhdGgKICAgICAgICAgKi8KICAgICAgICBzZWxmLmdldFBhdGggPSBmdW5jdGlvbih1cmwpIHsKICAgICAgICAgICAgaWYgKCF1cmwpIHsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuQ1FVUkxJbmZvICYmIENRVVJMSW5mby5yZXF1ZXN0UGF0aCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBDUVVSTEluZm8ucmVxdWVzdFBhdGg7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHVybCA9IHNlbGYucmVtb3ZlUGFyYW1ldGVycyh1cmwpOwogICAgICAgICAgICAgICAgdXJsID0gc2VsZi5yZW1vdmVBbmNob3IodXJsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdXJsID0gc2VsZi5pbnRlcm5hbGl6ZSh1cmwpOwogICAgICAgICAgICB2YXIgaSA9IHVybC5pbmRleE9mKCIuIiwgdXJsLmxhc3RJbmRleE9mKCIvIikpOwogICAgICAgICAgICBpZiAoaSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIHVybCA9IHVybC5zdWJzdHJpbmcoMCwgaSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHVybDsKICAgICAgICB9OwoKICAgICAgICAvKioKICAgICAgICAgKiBSZW1vdmVzIHRoZSBmcmFnbWVudCBjb21wb25lbnQgZnJvbSB0aGUgZ2l2ZW4gVVJJLgogICAgICAgICAqCiAgICAgICAgICogVGhpcyBtZXRob2QgYXNzdW1lcyB0aGUgVVJJIGlzIHZhbGlkLgogICAgICAgICAqCiAgICAgICAgICogZS5nLiBgc2NoZW1lOi8vdXNlcmluZm9AaG9zdDo4MC9wYXRoP3F1ZXJ5I2ZyYWdtZW50YCAtPiBgc2NoZW1lOi8vdXNlcmluZm9AaG9zdDo4MC9wYXRoP3F1ZXJ5YAogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHVyaSBUaGUgVVJJCiAgICAgICAgICogQHJldHVybnMge1N0cmluZ30gVGhlIFVSSSB3aXRob3V0IGZyYWdtZW50IGNvbXBvbmVudAogICAgICAgICAqLwogICAgICAgIHNlbGYucmVtb3ZlQW5jaG9yID0gZnVuY3Rpb24odXJpKSB7CiAgICAgICAgICAgIHZhciBmcmFnbWVudEluZGV4ID0gdXJpLmluZGV4T2YoIiMiKTsKICAgICAgICAgICAgaWYgKGZyYWdtZW50SW5kZXggPj0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVyaS5zdWJzdHJpbmcoMCwgZnJhZ21lbnRJbmRleCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdXJpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogUmVtb3ZlcyB0aGUgcXVlcnkgY29tcG9uZW50IGFuZCBpdHMgc3Vic2VxdWVudCBmcmFnbWVudCBjb21wb25lbnQgZnJvbSB0aGUgZ2l2ZW4gVVJJLgogICAgICAgICAqIGkuZS4gV2hlbiBxdWVyeSBjb21wb25lbnQgZXhpc3RzLCB0aGUgc3Vic2VxdWVudCBmcmFnbWVudCBjb21wb25lbnQgaXMgYWxzbyByZW1vdmVkLgogICAgICAgICAqIEhvd2V2ZXIsIHdoZW4gcXVlcnkgY29tcG9uZW50IGRvZXNuJ3QgZXhpc3QsIGZyYWdtZW50IGNvbXBvbmVudCBpcyBub3QgcmVtb3ZlZC4KICAgICAgICAgKgogICAgICAgICAqIFRoZSBhc3N1bXB0aW9uIGhlcmUgaXMgdGhhdCB0aGUgdXNhZ2VzIG9mIGAjYCBiZWZvcmUgdGhlIGA/YCBhcmUgaW50ZW5kZWQgYXMgcGFydCBvZiB0aGUgcGF0aCBjb21wb25lbnQKICAgICAgICAgKiB0aGF0IG5lZWQgdG8gYmUgZW5jb2RlZCBzZXBhcmF0ZWx5LgogICAgICAgICAqIFRoaXMgYXNzdW1wdGlvbiBpcyBtYWRlIGJlY2F1c2UgYGMuZC5jcS5jb21tb25zLmpjci5KY3JVdGlsI2lzVmFsaWROYW1lYCBhbGxvd3MgYCNgLgogICAgICAgICAqCiAgICAgICAgICogZS5nLiBgc2NoZW1lOi8vdXNlcmluZm9AaG9zdDo4MC9wYXRoI3dpdGgjaGFzaD9xdWVyeSNmcmFnbWVudGAgLT4gYHNjaGVtZTovL3VzZXJpbmZvQGhvc3Q6ODAvcGF0aCN3aXRoI2hhc2hgCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdXJpIFRoZSBVUkwKICAgICAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgVVJJIHdpdGhvdXQgdGhlIHF1ZXJ5IGNvbXBvbmVudCBhbmQgaXRzIHN1YnNlcXVlbnQgZnJhZ21lbnQgY29tcG9uZW50CiAgICAgICAgICovCiAgICAgICAgc2VsZi5yZW1vdmVQYXJhbWV0ZXJzID0gZnVuY3Rpb24odXJpKSB7CiAgICAgICAgICAgIHZhciBxdWVyeUluZGV4ID0gdXJpLmluZGV4T2YoIj8iKTsKICAgICAgICAgICAgaWYgKHF1ZXJ5SW5kZXggPj0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVyaS5zdWJzdHJpbmcoMCwgcXVlcnlJbmRleCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdXJpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogRW5jb2RlcyB0aGUgcGF0aCBjb21wb25lbnQgb2YgdGhlIGdpdmVuIFVSSSBpZiBpdCBpcyBub3QgYWxyZWFkeSBlbmNvZGVkLgogICAgICAgICAqIFNlZSB7QGxpbmsgI2VuY29kZVBhdGh9IGZvciB0aGUgZGV0YWlscyBvZiB0aGUgZW5jb2RpbmcuCiAgICAgICAgICoKICAgICAgICAgKiBlLmcuIGBzY2hlbWU6Ly91c2VyaW5mb0Bob3N0OjgwL3BhdGgjd2l0aCNoYXNoP3F1ZXJ5I2ZyYWdtZW50YAogICAgICAgICAqIC0+IGBzY2hlbWU6Ly91c2VyaW5mb0Bob3N0OjgwL3BhdGglMjN3aXRoJTIzaGFzaD9xdWVyeSNmcmFnbWVudGAKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmkgVGhlIFVSSSB0byBlbmNvZGUKICAgICAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgZW5jb2RlZCBVUkkKICAgICAgICAgKi8KICAgICAgICBzZWxmLmVuY29kZVBhdGhPZlVSSSA9IGZ1bmN0aW9uKHVyaSkgewogICAgICAgICAgICB2YXIgREVMSU1TID0gWyAiPyIsICIjIiBdOwoKICAgICAgICAgICAgdmFyIHBhcnRzID0gWyB1cmkgXTsKICAgICAgICAgICAgdmFyIGRlbGltOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbG4gPSBERUxJTVMubGVuZ3RoOyBpIDwgbG47IGkrKykgewogICAgICAgICAgICAgICAgZGVsaW0gPSBERUxJTVNbaV07CiAgICAgICAgICAgICAgICBpZiAodXJpLmluZGV4T2YoZGVsaW0pID49IDApIHsKICAgICAgICAgICAgICAgICAgICBwYXJ0cyA9IHVyaS5zcGxpdChkZWxpbSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChFTkNPREVfUEFUSF9SRUdFWFAudGVzdChwYXJ0c1swXSkpIHsKICAgICAgICAgICAgICAgIHBhcnRzWzBdID0gc2VsZi5lbmNvZGVQYXRoKHBhcnRzWzBdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHBhcnRzLmpvaW4oZGVsaW0pOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIEVuY29kZXMgdGhlIGdpdmVuIFVSSSB1c2luZyBgZW5jb2RlVVJJYC4KICAgICAgICAgKgogICAgICAgICAqIFRoaXMgbWV0aG9kIGlzIHVzZWQgdG8gZW5jb2RlIFVSSSBjb21wb25lbnRzIGZyb20gdGhlIHNjaGVtZSBjb21wb25lbnQgdXAgdG8gdGhlIHBhdGggY29tcG9uZW50IChpbmNsdXNpdmUpLgogICAgICAgICAqIFRoZXJlZm9yZSwgYD9gIGFuZCBgI2AgYXJlIGFsc28gZW5jb2RlZCBpbiBhZGRpdGlvbi4KICAgICAgICAgKgogICAgICAgICAqIEhvd2V2ZXIgYFtgIGFuZCBgXWAgYXJlIG5vdCBlbmNvZGVkLgogICAgICAgICAqIFRoZSBhc3N1bXB0aW9uIGhlcmUgaXMgdGhhdCB0aGUgdXNhZ2VzIG9mIGBbYCBhbmQgYF1gIGFyZSBvbmx5IGF0IHRoZSBob3N0IGNvbXBvbmVudCAoZm9yIElQdjYpLAogICAgICAgICAqIG5vdCBhdCB0aGUgcGF0aCBjb21wb25lbnQuCiAgICAgICAgICogVGhpcyBhc3N1bXB0aW9uIGlzIG1hZGUgYmVjYXVzZSBgYy5kLmNxLmNvbW1vbnMuamNyLkpjclV0aWwjaXNWYWxpZE5hbWVgIGRpc2FsbG93cyBgW2AgYW5kIGBdYC4KICAgICAgICAgKgogICAgICAgICAqIEV4YW1wbGVzCiAgICAgICAgICoKICAgICAgICAgKiAqIGBzY2hlbWU6Ly91c2VyaW5mb0Bob3N0OjgwL3BhdGg/cXVlcnkjZnJhZ21lbnRgIC0+IGBzY2hlbWU6Ly91c2VyaW5mb0Bob3N0OjgwL3BhdGglM0ZxdWVyeSUyM2ZyYWdtZW50YAogICAgICAgICAqICogYGh0dHA6Ly9bMjAwMTpkYjg6ODVhMzo4ZDM6MTMxOTo4YTJlOjM3MDo3MzQ4XS9gIC0+IGBodHRwOi8vWzIwMDE6ZGI4Ojg1YTM6OGQzOjEzMTk6OGEyZTozNzA6NzM0OF0vYAogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHVyaSBUaGUgVVJJIHRvIGVuY29kZQogICAgICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IFRoZSBlbmNvZGVkIFVSSQogICAgICAgICAqLwogICAgICAgIHNlbGYuZW5jb2RlUGF0aCA9IGZ1bmN0aW9uKHVyaSkgewogICAgICAgICAgICB1cmkgPSBlbmNvZGVVUkkodXJpKTsKCiAgICAgICAgICAgIC8vIERlY29kZSBiYWNrIGAlNUJgIGFuZCBgJTVEYC4KICAgICAgICAgICAgLy8gVGhlIGBbYCBhbmQgYF1gIGFyZSBub3QgdmFsaWQgY2hhcmFjdGVycyBhdCB0aGUgcGF0aCBjb21wb25lbnQgYW5kIG5lZWQgdG8gYmUgZW5jb2RlZCwKICAgICAgICAgICAgLy8gd2hpY2ggYGVuY29kZVVSSWAgZG9lcyBjb3JyZWN0bHkuCiAgICAgICAgICAgIC8vIEhvd2V2ZXIgYXMgbWVudGlvbmVkIGluIHRoZSBkb2MsIHRoZXkgYXJlIGFzc3VtZWQgdG8gYmUgdXNlZCBmb3IgYXV0aG9yaXR5IGNvbXBvbmVudCBvbmx5LgogICAgICAgICAgICB1cmkgPSB1cmkucmVwbGFjZSgvJTVCL2csICJbIikucmVwbGFjZSgvJTVEL2csICJdIik7CgogICAgICAgICAgICB1cmkgPSB1cmkucmVwbGFjZSgvXD8vZywgIiUzRiIpOwogICAgICAgICAgICB1cmkgPSB1cmkucmVwbGFjZSgvIy9nLCAiJTIzIik7CgogICAgICAgICAgICByZXR1cm4gdXJpOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIEhhbmRsZXMgbG9naW4gcmVkaXJlY3Rpb24gaWYgbmVlZGVkLgogICAgICAgICAqLwogICAgICAgIHNlbGYuaGFuZGxlTG9naW5SZWRpcmVjdCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoIWxvZ2luUmVkaXJlY3RlZCkgewogICAgICAgICAgICAgICAgbG9naW5SZWRpcmVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGFsZXJ0KEdyYW5pdGUuSTE4bi5nZXQoIllvdXIgcmVxdWVzdCBjb3VsZCBub3QgYmUgY29tcGxldGVkIGJlY2F1c2UgeW91IGhhdmUgYmVlbiBzaWduZWQgb3V0LiIpKTsKCiAgICAgICAgICAgICAgICB2YXIgbCA9IHV0aWwuZ2V0VG9wV2luZG93KCkuZG9jdW1lbnQubG9jYXRpb247CiAgICAgICAgICAgICAgICBsLmhyZWYgPSBzZWxmLmV4dGVybmFsaXplKCIvIikgKyAiP3Jlc291cmNlPSIgKyBlbmNvZGVVUklDb21wb25lbnQobC5wYXRobmFtZSArIGwuc2VhcmNoICsgbC5oYXNoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIEdldHMgdGhlIFhIUiBob29rZWQgVVJMIGlmIGNhbGxlZCBpbiBhIHBvcnRsZXQgY29udGV4dAogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHVybCBUaGUgVVJMIHRvIGdldAogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBtZXRob2QgVGhlIG1ldGhvZCB0byB1c2UgdG8gcmV0cmlldmUgdGhlIFhIUiBob29rZWQgVVJMCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHBhcmFtcyBUaGUgcGFyYW1ldGVycwogICAgICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IFRoZSBYSFIgaG9va2VkIFVSTCBpZiBhdmFpbGFibGUsIHRoZSBwcm92aWRlZCBVUkwgb3RoZXJ3aXNlCiAgICAgICAgICovCiAgICAgICAgc2VsZi5nZXRYaHJIb29rID0gZnVuY3Rpb24odXJsLCBtZXRob2QsIHBhcmFtcykgewogICAgICAgICAgICBtZXRob2QgPSBtZXRob2QgfHwgIkdFVCI7CiAgICAgICAgICAgIGlmICh3aW5kb3cuR19YSFJfSE9PSyAmJiB0eXBlb2YgR19YSFJfSE9PSyA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgdmFyIHAgPSB7CiAgICAgICAgICAgICAgICAgICAgInVybCI6IHVybCwKICAgICAgICAgICAgICAgICAgICAibWV0aG9kIjogbWV0aG9kCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgaWYgKHBhcmFtcykgewogICAgICAgICAgICAgICAgICAgIHBbInBhcmFtcyJdID0gcGFyYW1zOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIEdfWEhSX0hPT0socCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogRXZhbHVhdGVzIGFuZCByZXR1cm5zIHRoZSBib2R5IG9mIHRoZSBzcGVjaWZpZWQgcmVzcG9uc2Ugb2JqZWN0LgogICAgICAgICAqIEFsdGVybmF0aXZlbHksIGEgVVJMIGNhbiBiZSBzcGVjaWZpZWQsIGluIHdoaWNoIGNhc2UgaXQgd2lsbCBiZQogICAgICAgICAqIHJlcXVlc3RlZCB1c2luZyBhIHN5bmNocm9ub3VzIHtAbGluayAjZ2V0fSBpbiBvcmRlciB0byBhY3F1aXJlCiAgICAgICAgICogdGhlIHJlc3BvbnNlIG9iamVjdC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fFN0cmluZ30gcmVzcG9uc2UgVGhlIHJlc3BvbnNlIG9iamVjdCBvciBVUkwKICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBUaGUgZXZhbHVhdGVkIHJlc3BvbnNlIGJvZHkKICAgICAgICAgKiBAc2luY2UgNS4zCiAgICAgICAgICovCiAgICAgICAgc2VsZi5ldmFsID0gZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiByZXNwb25zZSAhPT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICB1cmw6IHJlc3BvbnNlLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJnZXQiLAogICAgICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIHN1cHBvcnQgcmVzcG9uc2VUZXh0IGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IChwcmUgNS4zKQogICAgICAgICAgICAgICAgdmFyIHRleHQgPSByZXNwb25zZS5ib2R5ID8gcmVzcG9uc2UuYm9keSA6IHJlc3BvbnNlLnJlc3BvbnNlVGV4dDsKICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKHRleHQpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAvLyBpZ25vcmVkCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICB9KCkpOwp9KSk7CgovKgogKiBBRE9CRSBDT05GSURFTlRJQUwKICogX19fX19fX19fX19fX19fX19fXwogKgogKiBDb3B5cmlnaHQgMjAxMiBBZG9iZQogKiBBbGwgUmlnaHRzIFJlc2VydmVkLgogKgogKiBOT1RJQ0U6IEFsbCBpbmZvcm1hdGlvbiBjb250YWluZWQgaGVyZWluIGlzLCBhbmQgcmVtYWlucwogKiB0aGUgcHJvcGVydHkgb2YgQWRvYmUgYW5kIGl0cyBzdXBwbGllcnMsIGlmIGFueS4gVGhlIGludGVsbGVjdHVhbAogKiBhbmQgdGVjaG5pY2FsIGNvbmNlcHRzIGNvbnRhaW5lZCBoZXJlaW4gYXJlIHByb3ByaWV0YXJ5IHRvIEFkb2JlCiAqIGFuZCBpdHMgc3VwcGxpZXJzIGFuZCBhcmUgcHJvdGVjdGVkIGJ5IGFsbCBhcHBsaWNhYmxlIGludGVsbGVjdHVhbAogKiBwcm9wZXJ0eSBsYXdzLCBpbmNsdWRpbmcgdHJhZGUgc2VjcmV0IGFuZCBjb3B5cmlnaHQgbGF3cy4KICogRGlzc2VtaW5hdGlvbiBvZiB0aGlzIGluZm9ybWF0aW9uIG9yIHJlcHJvZHVjdGlvbiBvZiB0aGlzIG1hdGVyaWFsCiAqIGlzIHN0cmljdGx5IGZvcmJpZGRlbiB1bmxlc3MgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uIGlzIG9idGFpbmVkCiAqIGZyb20gQWRvYmUuCiAqLwooZnVuY3Rpb24oZmFjdG9yeSkgewogICAgInVzZSBzdHJpY3QiOwoKICAgIGlmICh0eXBlb2YgbW9kdWxlID09PSAib2JqZWN0IiAmJiBtb2R1bGUuZXhwb3J0cykgewogICAgICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKCJAZ3Jhbml0ZS9odHRwIikpOwogICAgfSBlbHNlIHsKICAgICAgICB3aW5kb3cuR3Jhbml0ZS5JMThuID0gZmFjdG9yeSh3aW5kb3cuR3Jhbml0ZS5IVFRQKTsKICAgIH0KfShmdW5jdGlvbihIVFRQKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgLyoqCiAgICAgKiBBIGhlbHBlciBjbGFzcyBwcm92aWRpbmcgYSBzZXQgb2YgdXRpbGl0aWVzIHJlbGF0ZWQgdG8gaW50ZXJuYXRpb25hbGl6YXRpb24gKGkxOG4pLgogICAgICoKICAgICAqIDxoMz5Mb2NhbGUgUHJpb3JpdGllczwvaDM+CiAgICAgKiA8cD5UaGUgbG9jYWxlIGlzIHJlYWQgYmFzZWQgb24gdGhlIGZvbGxvd2luZyBwcmlvcml0aWVzOjwvcD4KICAgICAqIDxvbD4KICAgICAqICAgPGxpPm1hbnVhbGx5IHNwZWNpZmllZCBsb2NhbGU8L2xpPgogICAgICogICA8bGk+PGNvZGU+ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lmxhbmc8L2NvZGU+PC9saT4KICAgICAqICAgPGxpPjxjb2RlPkdyYW5pdGUuSTE4bi5MT0NBTEVfREVGQVVMVDwvY29kZT48L2xpPgogICAgICogPC9vbD4KICAgICAqCiAgICAgKiA8aDM+RGljdGlvbmFyeSBQcmlvcml0aWVzPC9oMz4KICAgICAqIDxwPlRoZSBkaWN0aW9uYXJ5IFVSTCBpcyByZWFkIGJhc2VkIG9uIHRoZSBmb2xsb3dpbmcgcHJpb3JpdGllczo8L3A+CiAgICAgKiA8b2w+CiAgICAgKiAgIDxsaT5tYW51YWxseSBzcGVjaWZpZWQgVVJMICg8Y29kZT51cmxQcmVmaXg8L2NvZGUsIDxjb2RlPnVybFN1ZmZpeDwvY29kZT4pPC9saT4KICAgICAqICAgPGxpPjxjb2RlPmRhdGEtaTE4bi1kaWN0aW9uYXJ5LXNyYzwvY29kZT4gYXR0cmlidXRlIGF0ICZsdDtodG1sJmd0OyBlbGVtZW50LAogICAgICogICAgICAgd2hpY2ggaGFzIHRoZSB0eXBlIG9mIDxhIGhyZWY9Imh0dHA6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzY1NzAiPlVSSSBUZW1wbGF0ZTwvYT4gc3RyaW5nPC9saT4KICAgICAqICAgPGxpPlRoZSBVUkwgcmVzb2x2ZWQgZnJvbSBkZWZhdWx0IDxjb2RlPnVybFByZWZpeDwvY29kZT4gYW5kIDxjb2RlPnVybFN1ZmZpeDwvY29kZT48L2xpPgogICAgICogPC9vbD4KICAgICAqCiAgICAgKiA8aDM+VVJJIFRlbXBsYXRlIG9mIGRhdGEtaTE4bi1kaWN0aW9uYXJ5LXNyYzwvaDM+CiAgICAgKiA8cD5JdCBleHBlY3RzIHRoZSB2YXJpYWJsZSBuYW1lZCA8Y29kZT5sb2NhbGU8L2NvZGU+LAogICAgICogd2hpY2ggd2lsbCBiZSBmZXRjaGVkIGZyb20gdGhlIGxvY2FsZSAoYmFzZWQgb24gcHJpb3JpdGllcyBhYm92ZSkuCiAgICAgKiBFLmcuIDxjb2RlPiZsdDtodG1sIGxhbmc9ImVuIiBkYXRhLWkxOG4tZGljdGlvbmFyeS1zcmM9Ii9saWJzL2NxL2kxOG4vZGljdC57K2xvY2FsZX0uanNvbiImZ3Q7PC9jb2RlPi48L3A+CiAgICAgKgogICAgICogQHN0YXRpYwogICAgICogQGNsYXNzIEdyYW5pdGUuSTE4bgogICAgICovCiAgICByZXR1cm4gKGZ1bmN0aW9uKCkgewogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBtYXAgd2hlcmUgdGhlIGRpY3Rpb25hcmllcyBhcmUgc3RvcmVkIHVuZGVyIHRoZWlyIGxvY2FsZS4KICAgICAgICAgKiBAdHlwZSBPYmplY3QKICAgICAgICAgKi8KICAgICAgICB2YXIgZGljdHMgPSB7fTsKCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIHByZWZpeCBmb3IgdGhlIFVSTCB1c2VkIHRvIHJlcXVlc3QgZGljdGlvbmFyaWVzIGZyb20gdGhlIHNlcnZlci4KICAgICAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAgICAgKi8KICAgICAgICB2YXIgdXJsUHJlZml4ID0gIi9saWJzL2NxL2kxOG4vZGljdC4iOwoKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgc3VmZml4IGZvciB0aGUgVVJMIHVzZWQgdG8gcmVxdWVzdCBkaWN0aW9uYXJpZXMgZnJvbSB0aGUgc2VydmVyLgogICAgICAgICAqIEB0eXBlIFN0cmluZwogICAgICAgICAqLwogICAgICAgIHZhciB1cmxTdWZmaXggPSAiLmpzb24iOwoKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgbWFudWFsbHkgc3BlY2lmaWVkIGxvY2FsZSBhcyBhIFN0cmluZyBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgbG9jYWxlIGFzIGEgc3RyaW5nLgogICAgICAgICAqIEB0eXBlIFN0cmluZwogICAgICAgICAqLwogICAgICAgIHZhciBtYW51YWxMb2NhbGUgPSB1bmRlZmluZWQ7CgogICAgICAgIC8qKgogICAgICAgICAqIElmIHRoZSBjdXJyZW50IGxvY2FsZSByZXByZXNlbnRzIHBzZXVkbyB0cmFuc2xhdGlvbnMuCiAgICAgICAgICogSW4gdGhhdCBjYXNlIHRoZSBkaWN0aW9uYXJ5IGlzIGV4cGVjdGVkIHRvIHByb3ZpZGUganVzdCBhIHNwZWNpYWwKICAgICAgICAgKiB0cmFuc2xhdGlvbiBwYXR0ZXJuIHRvIGF1dG9tYXRpY2FsbHkgY29udmVydCBhbGwgb3JpZ2luYWwgc3RyaW5ncy4KICAgICAgICAgKi8KICAgICAgICB2YXIgcHNldWRvVHJhbnNsYXRpb25zID0gZmFsc2U7CgogICAgICAgIHZhciBsYW5ndWFnZXMgPSBudWxsOwoKICAgICAgICB2YXIgc2VsZiA9IHt9OwoKICAgICAgICAvKioKICAgICAgICAgKiBJbmRpY2F0ZXMgaWYgdGhlIGRpY3Rpb25hcnkgcGFyYW1ldGVycyBhcmUgc3BlY2lmaWVkIG1hbnVhbGx5LgogICAgICAgICAqLwogICAgICAgIHZhciBtYW51YWxEaWN0aW9uYXJ5ID0gZmFsc2U7CgogICAgICAgIHZhciBnZXREaWN0aW9uYXJ5VXJsID0gZnVuY3Rpb24obG9jYWxlKSB7CiAgICAgICAgICAgIGlmIChtYW51YWxEaWN0aW9uYXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdXJsUHJlZml4ICsgbG9jYWxlICsgdXJsU3VmZml4OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgZGljdGlvbmFyeVNyYzsKICAgICAgICAgICAgdmFyIGh0bWxFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImh0bWwiKTsKICAgICAgICAgICAgaWYgKGh0bWxFbCkgewogICAgICAgICAgICAgICAgZGljdGlvbmFyeVNyYyA9IGh0bWxFbC5nZXRBdHRyaWJ1dGUoImRhdGEtaTE4bi1kaWN0aW9uYXJ5LXNyYyIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWRpY3Rpb25hcnlTcmMpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1cmxQcmVmaXggKyBsb2NhbGUgKyB1cmxTdWZmaXg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRpY3Rpb25hcnlTcmMgaXMgYSBVUklUZW1wbGF0ZQogICAgICAgICAgICAvLyBVc2Ugc2ltcGxlIHN0cmluZyByZXBsYWNlbWVudCBmb3Igbm93OyBmb3IgbW9yZSBjb21wbGljYXRlZCBzY2VuYXJpbywgcGxlYXNlIHVzZSBHcmFuaXRlLlVSSVRlbXBsYXRlCiAgICAgICAgICAgIHJldHVybiBkaWN0aW9uYXJ5U3JjLnJlcGxhY2UoIntsb2NhbGV9IiwgZW5jb2RlVVJJQ29tcG9uZW50KGxvY2FsZSkpLnJlcGxhY2UoInsrbG9jYWxlfSIsIGxvY2FsZSk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIHBhdGNoVGV4dCA9IGZ1bmN0aW9uKHRleHQsIHNuaXBwZXRzKSB7CiAgICAgICAgICAgIGlmIChzbmlwcGV0cykgewogICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc25pcHBldHMpKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzbmlwcGV0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKCJ7IiArIGkgKyAifSIsIHNuaXBwZXRzW2ldKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoInswfSIsIHNuaXBwZXRzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGV4dDsKICAgICAgICB9OwoKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgZGVmYXVsdCBsb2NhbGUgKGVuKS4KICAgICAgICAgKiBAcmVhZG9ubHkKICAgICAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAgICAgKi8KICAgICAgICBzZWxmLkxPQ0FMRV9ERUZBVUxUID0gImVuIjsKCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGxhbmd1YWdlIGNvZGUgZm9yIHBzZXVkbyB0cmFuc2xhdGlvbnMuCiAgICAgICAgICogQHJlYWRvbmx5CiAgICAgICAgICogQHR5cGUgU3RyaW5nCiAgICAgICAgICovCiAgICAgICAgc2VsZi5QU0VVRE9fTEFOR1VBR0UgPSAienoiOwoKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgZGljdGlvbmFyeSBrZXkgZm9yIHBzZXVkbyB0cmFuc2xhdGlvbiBwYXR0ZXJuLgogICAgICAgICAqIEByZWFkb25seQogICAgICAgICAqIEB0eXBlIFN0cmluZwogICAgICAgICAqLwogICAgICAgIHNlbGYuUFNFVURPX1BBVFRFUk5fS0VZID0gIl9wc2V1ZG9QYXR0ZXJuXyI7CgogICAgICAgIC8qKgogICAgICAgICAqIEluaXRpYWxpemVzIEkxOG4gd2l0aCB0aGUgZ2l2ZW4gY29uZmlnIG9wdGlvbnM6CiAgICAgICAgICogPHVsPgogICAgICAgICAqIDxsaT5sb2NhbGU6IHRoZSBjdXJyZW50IGxvY2FsZSAoZGVmYXVsdHMgdG8gImVuIik8L2xpPgogICAgICAgICAqIDxsaT51cmxQcmVmaXg6IHRoZSBwcmVmaXggZm9yIHRoZSBVUkwgdXNlZCB0byByZXF1ZXN0IGRpY3Rpb25hcmllcyBmcm9tCiAgICAgICAgICogdGhlIHNlcnZlciAoZGVmYXVsdHMgdG8gIi9saWJzL2NxL2kxOG4vZGljdC4iKTwvbGk+CiAgICAgICAgICogPGxpPnVybFN1ZmZpeDogdGhlIHN1ZmZpeCBmb3IgdGhlIFVSTCB1c2VkIHRvIHJlcXVlc3QgZGljdGlvbmFyaWVzIGZyb20KICAgICAgICAgKiB0aGUgc2VydmVyIChkZWZhdWx0cyB0byAiLmpzb24iKTwvbGk+CiAgICAgICAgICogPC91bD4KICAgICAgICAgKiBTYW1wbGUgY29uZmlnLiBUaGUgZGljdGlvbmFyeSB3b3VsZCBiZSByZXF1ZXN0ZWQgZnJvbQogICAgICAgICAqICIvYXBwcy9pMThuL2RpY3QuZnIuanNvbiI6CiAgICAgICAgIDxjb2RlPjxwcmU+ewogICAgICAgICAibG9jYWxlIjogImZyIiwKICAgICAgICAgInVybFByZWZpeCI6ICIvYXBwcy9pMThuL2RpY3QuIiwKICAgICAgICAgInVybFN1ZmZpeCI6ICIuanNvbiIKICAgICAgICAgfTwvcHJlPjwvY29kZT4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgVGhlIGNvbmZpZwogICAgICAgICAqLwogICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKGNvbmZpZykgewogICAgICAgICAgICBjb25maWcgPSBjb25maWcgfHwge307CgogICAgICAgICAgICB0aGlzLnNldExvY2FsZShjb25maWcubG9jYWxlKTsKICAgICAgICAgICAgdGhpcy5zZXRVcmxQcmVmaXgoY29uZmlnLnVybFByZWZpeCk7CiAgICAgICAgICAgIHRoaXMuc2V0VXJsU3VmZml4KGNvbmZpZy51cmxTdWZmaXgpOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIFNldHMgdGhlIGN1cnJlbnQgbG9jYWxlLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd8RnVuY3Rpb259IGxvY2FsZSBUaGUgbG9jYWxlIG9yIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBsb2NhbGUgYXMgYSBzdHJpbmcKICAgICAgICAgKi8KICAgICAgICBzZWxmLnNldExvY2FsZSA9IGZ1bmN0aW9uKGxvY2FsZSkgewogICAgICAgICAgICBpZiAoIWxvY2FsZSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1hbnVhbExvY2FsZSA9IGxvY2FsZTsKICAgICAgICB9OwoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IGxvY2FsZSBiYXNlZCBvbiB0aGUgcHJpb3JpdGllcy4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IFRoZSBsb2NhbGUKICAgICAgICAgKi8KICAgICAgICBzZWxmLmdldExvY2FsZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAodHlwZW9mIG1hbnVhbExvY2FsZSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgLy8gZXhlY3V0ZSBmdW5jdGlvbiBmaXJzdCB0aW1lIG9ubHkgYW5kIHN0b3JlIHJlc3VsdCBpbiBjdXJyZW50TG9jYWxlCiAgICAgICAgICAgICAgICBtYW51YWxMb2NhbGUgPSBtYW51YWxMb2NhbGUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbWFudWFsTG9jYWxlIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nIHx8IHNlbGYuTE9DQUxFX0RFRkFVTFQ7CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyB0aGUgcHJlZml4IGZvciB0aGUgVVJMIHVzZWQgdG8gcmVxdWVzdCBkaWN0aW9uYXJpZXMgZnJvbQogICAgICAgICAqIHRoZSBzZXJ2ZXIuIFRoZSBsb2NhbGUgYW5kIFVSTCBzdWZmaXggd2lsbCBiZSBhcHBlbmRlZC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwcmVmaXggVGhlIFVSTCBwcmVmaXgKICAgICAgICAgKi8KICAgICAgICBzZWxmLnNldFVybFByZWZpeCA9IGZ1bmN0aW9uKHByZWZpeCkgewogICAgICAgICAgICBpZiAoIXByZWZpeCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVybFByZWZpeCA9IHByZWZpeDsKICAgICAgICAgICAgbWFudWFsRGljdGlvbmFyeSA9IHRydWU7CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyB0aGUgc3VmZml4IGZvciB0aGUgVVJMIHVzZWQgdG8gcmVxdWVzdCBkaWN0aW9uYXJpZXMgZnJvbQogICAgICAgICAqIHRoZSBzZXJ2ZXIuIEl0IHdpbGwgYmUgYXBwZW5kZWQgdG8gdGhlIFVSTCBwcmVmaXggYW5kIGxvY2FsZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdWZmaXggVGhlIFVSTCBzdWZmaXgKICAgICAgICAgKi8KICAgICAgICBzZWxmLnNldFVybFN1ZmZpeCA9IGZ1bmN0aW9uKHN1ZmZpeCkgewogICAgICAgICAgICBpZiAoIXN1ZmZpeCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVybFN1ZmZpeCA9IHN1ZmZpeDsKICAgICAgICAgICAgbWFudWFsRGljdGlvbmFyeSA9IHRydWU7CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgZGljdGlvbmFyeSBmb3IgdGhlIHNwZWNpZmllZCBsb2NhbGUuIFRoaXMgbWV0aG9kCiAgICAgICAgICogd2lsbCByZXF1ZXN0IHRoZSBkaWN0aW9uYXJ5IHVzaW5nIHRoZSBVUkwgcHJlZml4LCB0aGUgbG9jYWxlLAogICAgICAgICAqIGFuZCB0aGUgVVJMIHN1ZmZpeC4gSWYgbm8gbG9jYWxlIGlzIHNwZWNpZmllZCwgdGhlIGN1cnJlbnQKICAgICAgICAgKiBsb2NhbGUgaXMgdXNlZC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBsb2NhbGUgKG9wdGlvbmFsKSBUaGUgbG9jYWxlCiAgICAgICAgICogQHJldHVybnMge09iamVjdH0gVGhlIGRpY3Rpb25hcnkKICAgICAgICAgKi8KICAgICAgICBzZWxmLmdldERpY3Rpb25hcnkgPSBmdW5jdGlvbihsb2NhbGUpIHsKICAgICAgICAgICAgbG9jYWxlID0gbG9jYWxlIHx8IHNlbGYuZ2V0TG9jYWxlKCk7CgogICAgICAgICAgICBpZiAoIWRpY3RzW2xvY2FsZV0pIHsKICAgICAgICAgICAgICAgIHBzZXVkb1RyYW5zbGF0aW9ucyA9IGxvY2FsZS5pbmRleE9mKHNlbGYuUFNFVURPX0xBTkdVQUdFKSA9PT0gMDsKCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgICAgICAgICAgICB4aHIub3BlbigiR0VUIiwgSFRUUC5leHRlcm5hbGl6ZShnZXREaWN0aW9uYXJ5VXJsKGxvY2FsZSkpLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgeGhyLnNlbmQoKTsKCiAgICAgICAgICAgICAgICAgICAgZGljdHNbbG9jYWxlXSA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWdub3JlZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFkaWN0c1tsb2NhbGVdKSB7CiAgICAgICAgICAgICAgICAgICAgZGljdHNbbG9jYWxlXSA9IHt9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBkaWN0c1tsb2NhbGVdOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIFRyYW5zbGF0ZXMgdGhlIHNwZWNpZmllZCB0ZXh0IGludG8gdGhlIGN1cnJlbnQgbGFuZ3VhZ2UuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBUaGUgdGV4dCB0byB0cmFuc2xhdGUKICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ1tdfSBzbmlwcGV0cyBUaGUgc25pcHBldHMgcmVwbGFjaW5nIDxjb2RlPntufTwvY29kZT4gKG9wdGlvbmFsKQogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBub3RlIEEgaGludCBmb3IgdHJhbnNsYXRvcnMgKG9wdGlvbmFsKQogICAgICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IFRoZSB0cmFuc2xhdGVkIHRleHQKICAgICAgICAgKi8KICAgICAgICBzZWxmLmdldCA9IGZ1bmN0aW9uKHRleHQsIHNuaXBwZXRzLCBub3RlKSB7CiAgICAgICAgICAgIHZhciBkaWN0OwogICAgICAgICAgICB2YXIgbmV3VGV4dDsKICAgICAgICAgICAgdmFyIGxvb2t1cFRleHQ7CgogICAgICAgICAgICBkaWN0ID0gc2VsZi5nZXREaWN0aW9uYXJ5KCk7CgogICAgICAgICAgICAvLyBub3RlIHRoYXQgcHNldWRvVHJhbnNsYXRpb25zIGlzIGluaXRpYWxpemVkIGluIHRoZSBnZXREaWN0aW9uYXJ5KCkgY2FsbCBhYm92ZQogICAgICAgICAgICBsb29rdXBUZXh0ID0gcHNldWRvVHJhbnNsYXRpb25zID8gc2VsZi5QU0VVRE9fUEFUVEVSTl9LRVkKICAgICAgICAgICAgICAgIDogbm90ZSA/IHRleHQgKyAiICgoIiArIG5vdGUgKyAiKSkiCiAgICAgICAgICAgICAgICAgICAgOiB0ZXh0OwogICAgICAgICAgICBpZiAoZGljdCkgewogICAgICAgICAgICAgICAgbmV3VGV4dCA9IGRpY3RbbG9va3VwVGV4dF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFuZXdUZXh0KSB7CiAgICAgICAgICAgICAgICBuZXdUZXh0ID0gdGV4dDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocHNldWRvVHJhbnNsYXRpb25zKSB7CiAgICAgICAgICAgICAgICBuZXdUZXh0ID0gbmV3VGV4dC5yZXBsYWNlKCJ7c3RyaW5nfSIsIHRleHQpLnJlcGxhY2UoIntjb21tZW50fSIsIG5vdGUgPyBub3RlIDogIiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwYXRjaFRleHQobmV3VGV4dCwgc25pcHBldHMpOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIFRyYW5zbGF0ZXMgdGhlIHNwZWNpZmllZCB0ZXh0IGludG8gdGhlIGN1cnJlbnQgbGFuZ3VhZ2UuIFVzZSB0aGlzCiAgICAgICAgICogbWV0aG9kIHRvIHRyYW5zbGF0ZSBTdHJpbmcgdmFyaWFibGVzLCBlLmcuIGRhdGEgZnJvbSB0aGUgc2VydmVyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHRleHQgVGhlIHRleHQgdG8gdHJhbnNsYXRlCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5vdGUgQSBoaW50IGZvciB0cmFuc2xhdG9ycyAob3B0aW9uYWwpCiAgICAgICAgICogQHJldHVybnMge1N0cmluZ30gVGhlIHRyYW5zbGF0ZWQgdGV4dAogICAgICAgICAqLwogICAgICAgIHNlbGYuZ2V0VmFyID0gZnVuY3Rpb24odGV4dCwgbm90ZSkgewogICAgICAgICAgICBpZiAoIXRleHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzZWxmLmdldCh0ZXh0LCBudWxsLCBub3RlKTsKICAgICAgICB9OwoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSBhdmFpbGFibGUgbGFuZ3VhZ2VzLCBpbmNsdWRpbmcgYSAidGl0bGUiIHByb3BlcnR5IHdpdGggYSBkaXNwbGF5IG5hbWU6CiAgICAgICAgICogZm9yIGluc3RhbmNlICJHZXJtYW4iIGZvciAiZGUiIG9yICJHZXJtYW4gKFN3aXR6ZXJsYW5kKSIgZm9yICJkZV9jaCIuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBBbiBvYmplY3Qgd2l0aCBsYW5ndWFnZSBjb2RlcyBhcyBrZXlzIGFuZCBhbiBvYmplY3Qgd2l0aCAidGl0bGUiLAogICAgICAgICAqICAgICAgICAgICAgICAgICAgImxhbmd1YWdlIiwgImNvdW50cnkiIGFuZCAiZGVmYXVsdENvdW50cnkiIG1lbWJlcnMuCiAgICAgICAgICovCiAgICAgICAgc2VsZi5nZXRMYW5ndWFnZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKCFsYW5ndWFnZXMpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgLy8gdXNlIG92ZXJsYXkgc2VydmxldCBzbyBjdXN0b21lcnMgY2FuIGRlZmluZSAvYXBwcy93Y20vY29yZS9yZXNvdXJjZXMvbGFuZ3VhZ2VzCiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogYnJva2VuISEhCiAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IEhUVFAuZXh0ZXJuYWxpemUoIi9saWJzL3djbS9jb3JlL3Jlc291cmNlcy9sYW5ndWFnZXMub3ZlcmxheS5pbmZpbml0eS5qc29uIik7CiAgICAgICAgICAgICAgICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgICAgICAgICAgICAgIHhoci5vcGVuKCJHRVQiLCB1cmwsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICB4aHIuc2VuZCgpOwoKICAgICAgICAgICAgICAgICAgICB2YXIganNvbiA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7CgogICAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGpzb24pLmZvckVhY2goZnVuY3Rpb24ocHJvcCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGFuZyA9IGpzb25bcHJvcF07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYW5nLmxhbmd1YWdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYW5nLnRpdGxlID0gc2VsZi5nZXRWYXIobGFuZy5sYW5ndWFnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxhbmcudGl0bGUgJiYgbGFuZy5jb3VudHJ5ICYmIGxhbmcuY291bnRyeSAhPT0gIioiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYW5nLnRpdGxlICs9ICIgKCIgKyBzZWxmLmdldFZhcihsYW5nLmNvdW50cnkpICsgIikiOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2VzID0ganNvbjsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZXMgPSB7fTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbGFuZ3VhZ2VzOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIFBhcnNlcyBhIGxhbmd1YWdlIGNvZGUgc3RyaW5nIHN1Y2ggYXMgImRlX0NIIiBhbmQgcmV0dXJucyBhbiBvYmplY3Qgd2l0aAogICAgICAgICAqIGxhbmd1YWdlIGFuZCBjb3VudHJ5IGV4dHJhY3RlZC4gVGhlIGRlbGltaXRlciBjYW4gYmUgIl8iIG9yICItIi4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBsYW5nQ29kZSBhIGxhbmd1YWdlIGNvZGUgc3VjaCBhcyAiZGUiIG9yICJkZV9DSCIgb3IgImRlLWNoIgogICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9IGFuIG9iamVjdCB3aXRoICJjb2RlIiAoImRlX0NIIiksICJsYW5ndWFnZSIgKCJkZSIpIGFuZCAiY291bnRyeSIgKCJDSCIpCiAgICAgICAgICogICAgICAgICAgICAgICAgICAob3IgbnVsbCBpZiBsYW5nQ29kZSB3YXMgbnVsbCkKICAgICAgICAgKi8KICAgICAgICBzZWxmLnBhcnNlTG9jYWxlID0gZnVuY3Rpb24obGFuZ0NvZGUpIHsKICAgICAgICAgICAgaWYgKCFsYW5nQ29kZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHBvcyA9IGxhbmdDb2RlLmluZGV4T2YoIl8iKTsKICAgICAgICAgICAgaWYgKHBvcyA8IDApIHsKICAgICAgICAgICAgICAgIHBvcyA9IGxhbmdDb2RlLmluZGV4T2YoIi0iKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGxhbmd1YWdlOwogICAgICAgICAgICB2YXIgY291bnRyeTsKICAgICAgICAgICAgaWYgKHBvcyA8IDApIHsKICAgICAgICAgICAgICAgIGxhbmd1YWdlID0gbGFuZ0NvZGU7CiAgICAgICAgICAgICAgICBjb3VudHJ5ID0gbnVsbDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxhbmd1YWdlID0gbGFuZ0NvZGUuc3Vic3RyaW5nKDAsIHBvcyk7CiAgICAgICAgICAgICAgICBjb3VudHJ5ID0gbGFuZ0NvZGUuc3Vic3RyaW5nKHBvcyArIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBjb2RlOiBsYW5nQ29kZSwKICAgICAgICAgICAgICAgIGxhbmd1YWdlOiBsYW5ndWFnZSwKICAgICAgICAgICAgICAgIGNvdW50cnk6IGNvdW50cnkKICAgICAgICAgICAgfTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gc2VsZjsKICAgIH0oKSk7Cn0pKTsKCi8qCiAqIEFET0JFIENPTkZJREVOVElBTAogKgogKiBDb3B5cmlnaHQgMjAxMiBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZAogKiBBbGwgUmlnaHRzIFJlc2VydmVkLgogKgogKiBOT1RJQ0U6ICBBbGwgaW5mb3JtYXRpb24gY29udGFpbmVkIGhlcmVpbiBpcywgYW5kIHJlbWFpbnMKICogdGhlIHByb3BlcnR5IG9mIEFkb2JlIFN5c3RlbXMgSW5jb3Jwb3JhdGVkIGFuZCBpdHMgc3VwcGxpZXJzLAogKiBpZiBhbnkuICBUaGUgaW50ZWxsZWN0dWFsIGFuZCB0ZWNobmljYWwgY29uY2VwdHMgY29udGFpbmVkCiAqIGhlcmVpbiBhcmUgcHJvcHJpZXRhcnkgdG8gQWRvYmUgU3lzdGVtcyBJbmNvcnBvcmF0ZWQgYW5kIGl0cwogKiBzdXBwbGllcnMgYW5kIG1heSBiZSBjb3ZlcmVkIGJ5IFUuUy4gYW5kIEZvcmVpZ24gUGF0ZW50cywKICogcGF0ZW50cyBpbiBwcm9jZXNzLCBhbmQgYXJlIHByb3RlY3RlZCBieSB0cmFkZSBzZWNyZXQgb3IgY29weXJpZ2h0IGxhdy4KICogRGlzc2VtaW5hdGlvbiBvZiB0aGlzIGluZm9ybWF0aW9uIG9yIHJlcHJvZHVjdGlvbiBvZiB0aGlzIG1hdGVyaWFsCiAqIGlzIHN0cmljdGx5IGZvcmJpZGRlbiB1bmxlc3MgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uIGlzIG9idGFpbmVkCiAqIGZyb20gQWRvYmUgU3lzdGVtcyBJbmNvcnBvcmF0ZWQuCiAqCiAqLwooZnVuY3Rpb24oZmFjdG9yeSkgewogICAgInVzZSBzdHJpY3QiOwoKICAgIGlmICh0eXBlb2YgbW9kdWxlID09PSAib2JqZWN0IiAmJiBtb2R1bGUuZXhwb3J0cykgewogICAgICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpOwogICAgfSBlbHNlIHsKICAgICAgICB2YXIgZyA9IHdpbmRvdy5HcmFuaXRlID0gd2luZG93LkdyYW5pdGUgfHwge307CiAgICAgICAgZy5Ub3VjaEluZGljYXRvciA9IGZhY3RvcnkoKTsKICAgIH0KfShmdW5jdGlvbigpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICBmdW5jdGlvbiBjcmVhdGVJbmRpY2F0b3IoKSB7CiAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgZWwuc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOwogICAgICAgIC8vIGZpeGVkIHdvdWxkIGJlIGJldHRlciwgYnV0IGZsaWNrZXJzIG9uIGlwYWQgd2hpbGUgc2Nyb2xsaW5nCiAgICAgICAgZWwuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgICAgIGVsLnN0eWxlLndpZHRoID0gIjMwcHgiOwogICAgICAgIGVsLnN0eWxlLmhlaWdodCA9ICIzMHB4IjsKICAgICAgICBlbC5zdHlsZS5ib3JkZXJSYWRpdXMgPSAiMjBweCI7CiAgICAgICAgZWwuc3R5bGUuYm9yZGVyID0gIjVweCBzb2xpZCBvcmFuZ2UiOwogICAgICAgIGVsLnN0eWxlLnVzZXJTZWxlY3QgPSAibm9uZSI7CiAgICAgICAgZWwuc3R5bGUub3BhY2l0eSA9ICIwLjUiOwogICAgICAgIGVsLnN0eWxlLnpJbmRleCA9ICIyMDAwIjsKICAgICAgICBlbC5zdHlsZS5wb2ludGVyRXZlbnRzID0gIm5vbmUiOwogICAgICAgIHJldHVybiBlbDsKICAgIH0KCiAgICB2YXIgdXNlZCA9IHt9OwoKICAgIHZhciB1bnVzZWQgPSBbXTsKCiAgICAvKioKICAgICAqIEltcGxlbWVudHMgdGhlICJBZG9iZSBEeW5hbWljIFRvdWNoIEluZGljYXRvciIgdGhhdCB0cmFja3MgdG91Y2ggZXZlbnRzIGFuZCBkaXNwbGF5cyBhIHZpc3VhbCBpbmRpY2F0b3IgZm9yCiAgICAgKiBzY3JlZW4gc2hhcmluZyBhbmQgcHJlc2VudGF0aW9uIHB1cnBvc2VzLgogICAgICoKICAgICAqIFRvIGVuYWJsZSBpdCwgY2FsbCA8Y29kZT5HcmFuaXRlLlRvdWNoSW5kaWNhdG9yLmluaXQoKTwvY29kZT4gZS5nLiBvbiBkb2N1bWVudCByZWFkeToKICAgICAqIDxwcmU+PGNvZGU+CiAgICAgKiBHcmFuaXRlLiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewogICAgICogICAgIEdyYW5pdGUuVG91Y2hJbmRpY2F0b3IuaW5pdCgpOwogICAgICogfSk7CiAgICAgKiA8L2NvZGU+PC9wcmU+CiAgICAgKgogICAgICogQWRvYmVQYXRlbnRJRD0iMjYzMVVTMDEiCiAgICAgKi8KICAgIHJldHVybiB7CiAgICAgICAgZGVidWdXaXRoTW91c2U6IGZhbHNlLAoKICAgICAgICBpbml0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHVwZGF0ZSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlKGUudG91Y2hlcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigidG91Y2hzdGFydCIsIHVwZGF0ZSk7CiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInRvdWNobW92ZSIsIHVwZGF0ZSk7CiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInRvdWNoZW5kIiwgdXBkYXRlKTsKCiAgICAgICAgICAgIGlmICh0aGlzLmRlYnVnV2l0aE1vdXNlKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW1vdmUiLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgICAgZS5pZGVudGlmZXIgPSAiZmFrZSI7CiAgICAgICAgICAgICAgICAgICAgc2VsZi51cGRhdGUoWyBlIF0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKHRvdWNoZXMpIHsKICAgICAgICAgICAgLy8gZ28gb3ZlciBhbGwgdG91Y2ggZXZlbnRzIHByZXNlbnQgaW4gdGhlIGFycmF5CiAgICAgICAgICAgIHZhciByZXRhaW5lZCA9IHt9OwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRvdWNoZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciB0b3VjaCA9IHRvdWNoZXNbaV07CiAgICAgICAgICAgICAgICB2YXIgaWQgPSB0b3VjaC5pZGVudGlmaWVyOwoKICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIHdlIGFscmVhZHkgaGF2ZSBhIGluZGljYXRvciB3aXRoIHRoZSBjb3JyZWN0IGlkCiAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yID0gdXNlZFtpZF07CiAgICAgICAgICAgICAgICBpZiAoIWluZGljYXRvcikgewogICAgICAgICAgICAgICAgICAgIC8vIGlmIG5vdCwgY2hlY2sgaWYgd2UgaGF2ZSBhbiB1bnVzZWQgb25lCiAgICAgICAgICAgICAgICAgICAgaW5kaWNhdG9yID0gdW51c2VkLnBvcCgpOwoKICAgICAgICAgICAgICAgICAgICAvLyBpZiBub3QsIGNyZWF0ZSBhIG5ldyBvbmUgYW5kIGFwcGVuZCBpdCB0byB0aGUgZG9tCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpbmRpY2F0b3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5kaWNhdG9yID0gY3JlYXRlSW5kaWNhdG9yKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaW5kaWNhdG9yKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0YWluZWRbaWRdID0gaW5kaWNhdG9yOwogICAgICAgICAgICAgICAgaW5kaWNhdG9yLnN0eWxlLmxlZnQgPSAodG91Y2gucGFnZVggLSAyMCkgKyAicHgiOwogICAgICAgICAgICAgICAgaW5kaWNhdG9yLnN0eWxlLnRvcCA9ICh0b3VjaC5wYWdlWSAtIDIwKSArICJweCI7CiAgICAgICAgICAgICAgICBpbmRpY2F0b3Iuc3R5bGUudmlzaWJpbGl0eSA9ICJ2aXNpYmxlIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbm93IGhpZGUgYWxsIHVudXNlZCBvbmVzIGFuZCBzdHVmZiB0aGVtIGluIHRoZSB1bnVzZWQgYXJyYXkKICAgICAgICAgICAgZm9yIChpZCBpbiB1c2VkKSB7CiAgICAgICAgICAgICAgICBpZiAodXNlZC5oYXNPd25Qcm9wZXJ0eShpZCkgJiYgIXJldGFpbmVkW2lkXSkgewogICAgICAgICAgICAgICAgICAgIGluZGljYXRvciA9IHVzZWRbaWRdOwogICAgICAgICAgICAgICAgICAgIGluZGljYXRvci5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CiAgICAgICAgICAgICAgICAgICAgdW51c2VkLnB1c2goaW5kaWNhdG9yKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB1c2VkID0gcmV0YWluZWQ7CiAgICAgICAgfQogICAgfTsKfSkpOwoKLyoKICogQURPQkUgQ09ORklERU5USUFMCiAqCiAqIENvcHlyaWdodCAyMDEyIEFkb2JlIFN5c3RlbXMgSW5jb3Jwb3JhdGVkCiAqIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCiAqCiAqIE5PVElDRTogIEFsbCBpbmZvcm1hdGlvbiBjb250YWluZWQgaGVyZWluIGlzLCBhbmQgcmVtYWlucwogKiB0aGUgcHJvcGVydHkgb2YgQWRvYmUgU3lzdGVtcyBJbmNvcnBvcmF0ZWQgYW5kIGl0cyBzdXBwbGllcnMsCiAqIGlmIGFueS4gIFRoZSBpbnRlbGxlY3R1YWwgYW5kIHRlY2huaWNhbCBjb25jZXB0cyBjb250YWluZWQKICogaGVyZWluIGFyZSBwcm9wcmlldGFyeSB0byBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZCBhbmQgaXRzCiAqIHN1cHBsaWVycyBhbmQgbWF5IGJlIGNvdmVyZWQgYnkgVS5TLiBhbmQgRm9yZWlnbiBQYXRlbnRzLAogKiBwYXRlbnRzIGluIHByb2Nlc3MsIGFuZCBhcmUgcHJvdGVjdGVkIGJ5IHRyYWRlIHNlY3JldCBvciBjb3B5cmlnaHQgbGF3LgogKiBEaXNzZW1pbmF0aW9uIG9mIHRoaXMgaW5mb3JtYXRpb24gb3IgcmVwcm9kdWN0aW9uIG9mIHRoaXMgbWF0ZXJpYWwKICogaXMgc3RyaWN0bHkgZm9yYmlkZGVuIHVubGVzcyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24gaXMgb2J0YWluZWQKICogZnJvbSBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZC4KICoKICovCihmdW5jdGlvbihmYWN0b3J5KSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgaWYgKHR5cGVvZiBtb2R1bGUgPT09ICJvYmplY3QiICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7CiAgICB9IGVsc2UgewogICAgICAgIHZhciBnID0gd2luZG93LkdyYW5pdGUgPSB3aW5kb3cuR3Jhbml0ZSB8fCB7fTsKICAgICAgICBnLk9wdE91dFV0aWwgPSBmYWN0b3J5KCk7CiAgICB9Cn0oZnVuY3Rpb24oJCkgewogICAgInVzZSBzdHJpY3QiOwoKICAgIGZ1bmN0aW9uIHRyaW0ocykgewogICAgICAgIGlmIChTdHJpbmcucHJvdG90eXBlLnRyaW0pIHsKICAgICAgICAgICAgcmV0dXJuIHMudHJpbSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcy5yZXBsYWNlKC9eW1xzXHVGRUZGXHhBMF0rfFtcc1x1RkVGRlx4QTBdKyQvZywgIiIpOwogICAgfQoKICAgIC8qKgogICAgICogQSBsaWJyYXJ5IHRvIGRldGVybWluZSB3aGV0aGVyIGFueSBvcHQtb3V0IGNvb2tpZSBpcyBzZXQgYW5kIHdoZXRoZXIgYSBnaXZlbiBjb29raWUgbmFtZSBpcyB3aGl0ZS1saXN0ZWQuCiAgICAgKgogICAgICogVGhlIG9wdC1vdXQgYW5kIHdoaXRlLWxpc3QgY29va2llIG5hbWVzIGFyZSBkZXRlcm1pbmVkIGJ5IGEgc2VydmVyLXNpZGUgY29uZmlndXJhdGlvbgogICAgICogKDxjb2RlPmNvbS5hZG9iZS5ncmFuaXRlLnNlY3VyaXR5LmNvbW1vbnMuT3B0T3V0U2VydmljZTwvY29kZT4pIGFuZCBwcm92aWRlZCB0byB0aGlzIHRvb2wgYnkgYW4gb3B0aW9uYWxseQogICAgICogaW5jbHVkZWQgY29tcG9uZW50ICg8Y29kZT4vbGlicy9ncmFuaXRlL3NlY3VyaXR5L2NvbXBvbmVudHMvb3B0b3V0PC9jb2RlPikgd2hpY2ggcHJvdmlkZXMgYSBnbG9iYWwgSlNPTiBvYmplY3QKICAgICAqIG5hbWVkIDxjb2RlPkdyYW5pdGVPcHRPdXRDb25maWc8L2NvZGU+LgogICAgICoKICAgICAqIEBzdGF0aWMKICAgICAqIEBjbGFzcyBHcmFuaXRlLk9wdE91dFV0aWwKICAgICAqLwogICAgcmV0dXJuIChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgc2VsZiA9IHt9OwoKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgbmFtZXMgb2YgY29va2llcyB0aGUgcHJlc2VuY2Ugb2Ygd2hpY2ggaW5kaWNhdGVzIHRoZSB1c2VyIGhhcyBvcHRlZCBvdXQuCiAgICAgICAgICogQHR5cGUgU3RyaW5nW10KICAgICAgICAgKi8KICAgICAgICB2YXIgb3B0T3V0Q29va2llTmFtZXMgPSBbXTsKCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIG5hbWVzIG9mIGNvb2tpZXMgd2hpY2ggbWF5IHN0aWxsIGJlIHNldCBpbiBzcGl0ZSBvZiB0aGUgdXNlciBoYXZpbmcgb3B0ZWQgb3V0LgogICAgICAgICAqIEB0eXBlIFN0cmluZ1tdCiAgICAgICAgICovCiAgICAgICAgdmFyIHdoaXRlbGlzdGVkQ29va2llTmFtZXMgPSBbXTsKCiAgICAgICAgLyoqCiAgICAgICAgICogSW5pdGlhbGl6ZXMgdGhpcyB0b29sIHdpdGggYW4gb3B0LW91dCBjb25maWd1cmF0aW9uLgogICAgICAgICAqCiAgICAgICAgICogVGhlIGZvbGxvd2luZyBvcHRpb25zIGFyZSBzdXBwb3J0ZWQ6CiAgICAgICAgICogPHVsPgogICAgICAgICAqICAgICA8bGk+Y29va2llTmFtZXM6IGFuIGFycmF5IG9mIGNvb2tpZSBuYW1lcyByZXByZXNlbnRpbmcgb3B0LW91dCBjb29raWVzLiBEZWZhdWx0cyB0byBlbXB0eS48L2xpPgogICAgICAgICAqICAgICA8bGk+d2hpdGVsaXN0Q29va2llTmFtZXM6IGFuIGFycmF5IG9mIGNvb2tpZXMgcmVwcmVzZW50aW5nIHdoaXRlLWxpc3RlZCBjb29raWVzLiBEZWZhdWx0cyB0byBlbXB0eS48L2xpPgogICAgICAgICAqIDwvdWw+CiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIFRoZSBvcHQtb3V0IGNvbmZpZ3VyYXRpb24uCiAgICAgICAgICoKICAgICAgICAgKiBAZXhhbXBsZQogICAgICAgICAqIHsKICAgICAgICAgKiAgICAgImNvb2tpZU5hbWVzIjogWyJvbW5pdHVyZV9vcHRvdXQiLCJjcS1vcHQtb3V0Il0sCiAgICAgICAgICogICAgICJ3aGl0ZWxpc3RDb29raWVOYW1lcyI6IFsic29tZUFwcENvb2tpZSIsICJhbm90aGVySW1wb3J0YW50QXBwQ29va2llIl0KICAgICAgICAgKiB9CiAgICAgICAgICovCiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24oY29uZmlnKSB7CiAgICAgICAgICAgIGlmIChjb25maWcpIHsKICAgICAgICAgICAgICAgIG9wdE91dENvb2tpZU5hbWVzID0gY29uZmlnLmNvb2tpZU5hbWVzIHx8IFtdOwogICAgICAgICAgICAgICAgd2hpdGVsaXN0ZWRDb29raWVOYW1lcyA9IGNvbmZpZy53aGl0ZWxpc3RDb29raWVOYW1lcyB8fCBbXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG9wdE91dENvb2tpZU5hbWVzID0gW107CiAgICAgICAgICAgICAgICB3aGl0ZWxpc3RlZENvb2tpZU5hbWVzID0gW107CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSBhcnJheSBvZiBjb25maWd1cmVkIGNvb2tpZSBuYW1lcyByZXByZXNlbnRpbmcgb3B0LW91dCBjb29raWVzLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybnMge1N0cmluZ1tdfSBUaGUgY29va2llIG5hbWVzLgogICAgICAgICAqLwogICAgICAgIHNlbGYuZ2V0Q29va2llTmFtZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIG9wdE91dENvb2tpZU5hbWVzOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIGFycmF5IG9mIGNvbmZpZ3VyZWQgY29va2llIG5hbWVzIHJlcHJlc2VudGluZyB3aGl0ZS1saXN0ZWQgY29va2llcy4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm5zIHtTdHJpbmdbXX0gVGhlIGNvb2tpZSBuYW1lcy4KICAgICAgICAgKi8KICAgICAgICBzZWxmLmdldFdoaXRlbGlzdENvb2tpZU5hbWVzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB3aGl0ZWxpc3RlZENvb2tpZU5hbWVzOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIERldGVybWluZXMgd2hldGhlciB0aGUgdXNlciAoYnJvd3NlcikgaGFzIGVsZWN0ZWQgdG8gb3B0LW91dC4KICAgICAgICAgKiBUaGlzIGlzIGluZGljYXRlZCBieSB0aGUgcHJlc2VuY2Ugb2Ygb25lIG9mIHRoZSBjb29raWVzIHJldHJpZXZlZCB0aHJvdWdoIHtAbGluayAjZ2V0Q29va2llTmFtZXMoKX0uCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gPGNvZGU+dHJ1ZTwvY29kZT4gaWYgYW4gb3B0LWNvb2tpZSB3YXMgZm91bmQgaW4gdGhlIGJyb3dzZXIncyBjb29raWVzOwogICAgICAgICAqICAgICA8Y29kZT5mYWxzZTwvY29kZT4gb3RoZXJ3aXNlLgogICAgICAgICAqLwogICAgICAgIHNlbGYuaXNPcHRlZE91dCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgYnJvd3NlckNvb2tpZXMgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoIjsiKTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBicm93c2VyQ29va2llcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIGNvb2tpZSA9IGJyb3dzZXJDb29raWVzW2ldOwogICAgICAgICAgICAgICAgdmFyIGNvb2tpZU5hbWUgPSB0cmltKGNvb2tpZS5zcGxpdCgiPSIpWzBdKTsKICAgICAgICAgICAgICAgIGlmIChzZWxmLmdldENvb2tpZU5hbWVzKCkuaW5kZXhPZihjb29raWVOYW1lKSA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIERldGVybWluZXMgd2hldGhlciB0aGUgZ2l2ZW4gPGNvZGU+Y29va2llTmFtZTwvY29kZT4gbWF5IGJlIHVzZWQgdG8gc2V0IGEgY29va2llLgogICAgICAgICAqIFRoaXMgaXMgdGhlIGNhc2UgaWYgZWl0aGVyIG9wdC1vdXQgaXMgaW5hY3RpdmUgKDxjb2RlPntAbGluayAjaXNPcHRlZE91dCgpfSA9PT0gZmFsc2U8L2NvZGU+KSBvciBpdCBpcwogICAgICAgICAqIGFjdGl2ZSBhbmQgdGhlIGdpdmUgY29va2llIG5hbWUgd2FzIGZvdW5kIGluIHRoZSB3aGl0ZS1saXN0ICh7QGxpbmsgI2dldFdoaXRlbGlzdENvb2tpZU5hbWVzKCl9KS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjb29raWVOYW1lIFRoZSBuYW1lIG9mIHRoZSBjb29raWUgdG8gY2hlY2suCiAgICAgICAgICogQHJldHVybnMge0Jvb2xlYW59IDxjb2RlPnRydWU8L2NvZGU+IGlmIGEgY29va2llIG9mIHRoaXMgbmFtZSBtYXkgYmUgdXNlZCB3aXRoIHJlc3BlY3QgdG8gdGhlIG9wdC1vdXQgc3RhdHVzOwogICAgICAgICAqICAgICA8Y29kZT5mYWxzZTwvY29kZT4gb3RoZXJ3aXNlLgogICAgICAgICAqLwogICAgICAgIHNlbGYubWF5U2V0Q29va2llID0gZnVuY3Rpb24oY29va2llTmFtZSkgewogICAgICAgICAgICByZXR1cm4gIShzZWxmLmlzT3B0ZWRPdXQoKSAmJiBzZWxmLmdldFdoaXRlbGlzdENvb2tpZU5hbWVzKCkuaW5kZXhPZihjb29raWVOYW1lKSA9PT0gLTEpOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBzZWxmOwogICAgfSgpKTsKfSkpOwoKLyoKICogQURPQkUgQ09ORklERU5USUFMCiAqCiAqIENvcHlyaWdodCAyMDEyIEFkb2JlIFN5c3RlbXMgSW5jb3Jwb3JhdGVkCiAqIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCiAqCiAqIE5PVElDRTogIEFsbCBpbmZvcm1hdGlvbiBjb250YWluZWQgaGVyZWluIGlzLCBhbmQgcmVtYWlucwogKiB0aGUgcHJvcGVydHkgb2YgQWRvYmUgU3lzdGVtcyBJbmNvcnBvcmF0ZWQgYW5kIGl0cyBzdXBwbGllcnMsCiAqIGlmIGFueS4gIFRoZSBpbnRlbGxlY3R1YWwgYW5kIHRlY2huaWNhbCBjb25jZXB0cyBjb250YWluZWQKICogaGVyZWluIGFyZSBwcm9wcmlldGFyeSB0byBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZCBhbmQgaXRzCiAqIHN1cHBsaWVycyBhbmQgbWF5IGJlIGNvdmVyZWQgYnkgVS5TLiBhbmQgRm9yZWlnbiBQYXRlbnRzLAogKiBwYXRlbnRzIGluIHByb2Nlc3MsIGFuZCBhcmUgcHJvdGVjdGVkIGJ5IHRyYWRlIHNlY3JldCBvciBjb3B5cmlnaHQgbGF3LgogKiBEaXNzZW1pbmF0aW9uIG9mIHRoaXMgaW5mb3JtYXRpb24gb3IgcmVwcm9kdWN0aW9uIG9mIHRoaXMgbWF0ZXJpYWwKICogaXMgc3RyaWN0bHkgZm9yYmlkZGVuIHVubGVzcyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24gaXMgb2J0YWluZWQKICogZnJvbSBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZC4KICoKICovCgoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gSW5pdGlhbGl6ZSB0aGUgR3Jhbml0ZSB1dGlscyBsaWJyYXJ5CgpHcmFuaXRlLk9wdE91dFV0aWwuaW5pdCh3aW5kb3cuR3Jhbml0ZU9wdE91dENvbmZpZyk7CkdyYW5pdGUuSFRUUC5kZXRlY3RDb250ZXh0UGF0aCgpOwoK",
    "headers" : {
      "Date" : "Mon, 31 Jan 2022 23:22:47 GMT",
      "X-Content-Type-Options" : "nosniff",
      "Set-Cookie" : "cq-authoring-mode=TOUCH; Path=/; Expires=Mon, 07-Feb-2022 23:22:47 GMT; Max-Age=604800",
      "Expires" : "Thu, 01 Jan 1970 00:00:00 GMT",
      "Last-Modified" : "Mon, 08 Nov 2021 21:01:23 GMT",
      "Content-Type" : "application/javascript;charset=utf-8"
    }
  },
  "uuid" : "a3994d11-d51e-462d-ba5b-671c86c02f6b",
  "persistent" : true,
  "insertionIndex" : 9
}